(function(){"use strict";var e={4842:function(e,t,o){var s=o(5130),i=o(6768);const a={id:"app"};function n(e,t,o,s,n,r){const c=(0,i.g2)("router-view"),l=(0,i.g2)("AppNotification");return(0,i.uX)(),(0,i.CE)("div",a,[(0,i.bF)(c,{showNotification:r.showNotification},null,8,["showNotification"]),(0,i.bF)(l,{message:n.notification.message,type:n.notification.type,visible:n.notification.visible},null,8,["message","type","visible"])])}var r=o(4232);function c(e,t,o,s,a,n){return o.visible?((0,i.uX)(),(0,i.CE)("div",{key:0,class:(0,r.C4)(["notification",o.type]),style:(0,r.Tr)(n.notificationStyle)},[(0,i.Lk)("span",null,(0,r.v_)(o.message),1)],6)):(0,i.Q3)("",!0)}var l={name:"AppNotification",props:["message","type","visible"],computed:{notificationStyle(){return{right:"20px",top:"20px",animation:this.visible?"fadeIn 0.5s ease":"fadeOut 0.5s ease"}}}},u=o(1241);const d=(0,u.A)(l,[["render",c],["__scopeId","data-v-48b28165"]]);var h=d,p={name:"App",components:{AppNotification:h},data(){return{notification:{message:"",type:"success",visible:!1}}},methods:{showNotification(e,t="success"){this.notification.message=e,this.notification.type=t,this.notification.visible=!0,setTimeout((()=>{this.notification.visible=!1}),4e3)}}};const m=(0,u.A)(p,[["render",n]]);var g=m,k=o(1387);const f={class:"login-container"},v={class:"login-card"},w={class:"form-group"},b={class:"form-group"};function y(e,t,o,a,n,r){return(0,i.uX)(),(0,i.CE)("div",f,[(0,i.Lk)("div",v,[t[6]||(t[6]=(0,i.Lk)("div",{class:"logo-container"},[(0,i.Lk)("img",{src:"https://logosandtypes.com/wp-content/uploads/2023/03/astro-framework.svg",alt:"Astro Logo",class:"logo"})],-1)),(0,i.Lk)("form",{onSubmit:t[2]||(t[2]=(0,s.D$)(((...e)=>r.handleLogin&&r.handleLogin(...e)),["prevent"]))},[(0,i.Lk)("div",w,[t[3]||(t[3]=(0,i.Lk)("label",{for:"username"},"Username",-1)),(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>n.username=e),id:"username",required:""},null,512),[[s.Jo,n.username]])]),(0,i.Lk)("div",b,[t[4]||(t[4]=(0,i.Lk)("label",{for:"password"},"Password",-1)),(0,i.bo)((0,i.Lk)("input",{type:"password","onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),id:"password",required:""},null,512),[[s.Jo,n.password]])]),t[5]||(t[5]=(0,i.Lk)("button",{type:"submit",class:"btn"},"Login",-1))],32),t[7]||(t[7]=(0,i.Lk)("p",{class:"signup-link"},[(0,i.eW)(" Don't have an account? "),(0,i.Lk)("a",{href:"/register"},"Sign up")],-1))])])}o(4114);var L={props:["showNotification"],name:"UserLogin",data(){return{username:"",password:""}},methods:{async handleLogin(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.username,password:this.password}),credentials:"include"});if(!e.ok)throw new Error("Login failed");const t=await e.json();console.log("dataaaaaaaA1",t),localStorage.setItem("xyz",t.xyz),this.$router.push("/home")}catch(e){this.showNotification("Login failed. Please check your credentials.","error"),console.error("Error during login:",e)}}}};const C=(0,u.A)(L,[["render",y],["__scopeId","data-v-bfdd0f22"]]);var E=C;const _={class:"register-container"},N={class:"register-card"},P=["for"],I=["type","id","onUpdate:modelValue","placeholder","required"],M={class:"form-group"};function F(e,t,o,a,n,c){return(0,i.uX)(),(0,i.CE)("div",_,[(0,i.Lk)("div",N,[t[5]||(t[5]=(0,i.Lk)("div",{class:"logo-container"},[(0,i.Lk)("img",{src:"https://logosandtypes.com/wp-content/uploads/2023/03/astro-framework.svg",alt:"Astro Logo",class:"logo"})],-1)),(0,i.Lk)("form",{onSubmit:t[1]||(t[1]=(0,s.D$)(((...e)=>c.handleRegister&&c.handleRegister(...e)),["prevent"]))},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.fields,((e,t)=>((0,i.uX)(),(0,i.CE)("div",{class:"form-group",key:t},[(0,i.Lk)("label",{for:t},(0,r.v_)(e.label),9,P),(0,i.bo)((0,i.Lk)("input",{type:e.type,id:t,"onUpdate:modelValue":e=>n.form[t]=e,placeholder:e.placeholder,required:!1!==e.required},null,8,I),[[s.hp,n.form[t]]])])))),128)),(0,i.Lk)("div",M,[t[2]||(t[2]=(0,i.Lk)("label",{for:"avatar"},"Avatar",-1)),(0,i.Lk)("input",{type:"file",id:"avatar",onChange:t[0]||(t[0]=(...e)=>c.onAvatarChange&&c.onAvatarChange(...e)),accept:"image/*"},null,32)]),t[3]||(t[3]=(0,i.Lk)("button",{type:"submit",class:"btn"},"Register",-1)),t[4]||(t[4]=(0,i.Lk)("p",{class:"login-link"},[(0,i.eW)(" Already have an account? "),(0,i.Lk)("a",{href:"/login"},"Login")],-1))],32)])])}var T={props:["showNotification"],name:"UserRegister",data(){return{form:{email:"",password:"",firstname:"",lastname:"",bio:"",birthday:"",nickname:""},avatarFile:null,fields:{email:{label:"Email",type:"email",placeholder:"test@example.com"},password:{label:"Password",type:"password",placeholder:"********"},firstname:{label:"First Name",type:"text",placeholder:"First Name"},lastname:{label:"Last Name",type:"text",placeholder:"Last Name"},nickname:{label:"Nickname",type:"text",placeholder:"Nickname (optional)",required:!1},bio:{label:"Bio",type:"text",placeholder:"Tell us about yourself",required:!1},birthday:{label:"Birthday",type:"date",placeholder:""}}}},methods:{onAvatarChange(e){this.avatarFile=e.target.files[0]},validateForm(){const e=[];if(/^[a-zA-Z0-9_]{3,20}$/.test(this.form.username)||e.push("Username must be 3-20 alphanumeric characters."),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.form.email)||e.push("Invalid email format."),/^[a-zA-Z]{1,30}$/.test(this.form.firstname)||e.push("First name must contain only letters."),/^[a-zA-Z]{1,30}$/.test(this.form.lastname)||e.push("Last name must contain only letters."),this.form.birthday){const t=new Date(this.form.birthday),o=new Date,s=13,i=100;if(isNaN(t.getTime()))e.push("Invalid date of birth format.");else{t>o&&e.push("Date of birth cannot be in the future.");const a=o.getFullYear()-t.getFullYear(),n=o.getMonth()-t.getMonth(),r=o.getDate()-t.getDate(),c=n<0||0===n&&r<0?a-1:a;c<s&&e.push(`You must be at least ${s} years old to register.`),c>i&&e.push(`Date of birth indicates an age over ${i} years.`)}}else e.push("Date of birth is required.");if(this.avatarFile){const t=["image/jpeg","image/png","image/gif"];t.includes(this.avatarFile.type)||e.push("Invalid avatar type (jpg/jpeg/png only)."),this.avatarFile.size>2097152&&e.push("Avatar must be under 2MB.")}return e},handleRegister(){if(this.errors=this.validateForm(),this.errors.length>0)return void this.showNotification("Please fix the following errors: "+this.errors.join(", "),"error");const e=new FormData;this.avatarFile&&e.append("avatar",this.avatarFile);const t=JSON.stringify(this.form);e.append("user",t),fetch("https://back-production-bb9b.up.railway.app//api/auth/register",{method:"POST",credentials:"include",body:e}).then((e=>{if(!e.ok)throw new Error("Registration failed");return e.json()})).then((e=>{this.showNotification("Registration successful!","success"),console.log("Success:",e),wn.push("/")})).catch((e=>{this.showNotification("Registration failed. Please try again.","error"),console.error("Error:",e)}))}}};const $=(0,u.A)(T,[["render",F],["__scopeId","data-v-f4b66c72"]]);var x=$;function X(e,t,o,s,a,n){return(0,i.uX)(),(0,i.CE)("div",null,"Loading...")}var U={name:"AuthMiddleware",data(){return{isLoggedIn:!1}},methods:{async checkLogin(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//middle",{method:"GET",credentials:"include"}),t=await e.json();"Login successful"===t.message?(this.isLoggedIn=!0,this.$router.push("/home")):(this.isLoggedIn=!1,this.$router.push("/login"))}catch(e){console.error("Error during login check:",e),this.$router.push("/login")}}},mounted(){this.checkLogin()}};const S=(0,u.A)(U,[["render",X]]);var j=S;const A={id:"info"};function G(e,t,o,s,a,n){return(0,i.uX)(),(0,i.CE)("div",A,t[0]||(t[0]=[(0,i.Lk)("h1",null,"Loading Information",-1)]))}var D={name:"ChechInfo",data(){return{info:null}},methods:{async fetchInfo(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/info",{method:"GET",credentials:"include"});if(!e.ok)throw console.log("Response not ok"),new Error("Network response was not ok");const t=await e.json();console.log("Data:",t),this.info=t}catch(e){console.error("Error fetching info:",e)}}},created(){this.fetchInfo()}};const O=(0,u.A)(D,[["render",G]]);var q=O;const Q={class:"forum-layout"},R={class:"sidebar"},B={class:"sidebar-icons"},V={key:0,class:"notif-badge"},H={key:0,ref:"notifPopup",class:"notif-popup"},J={class:"notif-list"},W={key:0,class:"notif-item empty"},K=["onClick"],z={class:"notif-text"},Y={key:0},Z={key:1},ee={class:"notif-time"},te={class:"main-area"},oe={class:"avatar-bar"},se={class:"avatar-list"},ie=["src","alt","onClick"],ae={class:"avatar-name"},ne={class:"create-post-card"},re=["src"],ce={class:"file-upload-label"},le=["src"],ue={class:"create-post-row"},de={class:"status-select"},he={key:1,class:"allowed-users-select"},pe={key:0},me=["value"],ge={class:"custom-checkbox"},ke={key:0,width:"18",height:"18",viewBox:"0 0 18 18",fill:"none"},fe={key:1,width:"18",height:"18",viewBox:"0 0 18 18",fill:"none"},ve=["src","alt"],we={class:"allowed-user-name"},be={key:2,class:"message"},ye={class:"posts-grid"},Le={key:0,class:"no-posts"},Ce={key:0,class:"post-image"},Ee=["src"],_e={class:"post-header"},Ne=["src"],Pe={class:"post-timestamp"},Ie={class:"post-title"},Me={class:"post-content"},Fe=["src"],Te={class:"post-actions"},$e=["onClick"],xe={key:2,class:"comments-section"},Xe={key:0,class:"no-comments"},Ue={class:"comment-header"},Se=["src"],je={class:"comment-timestamp"},Ae={class:"comment-content"},Ge=["src"],De=["onSubmit"],Oe={class:"comment-input-row"},qe=["onUpdate:modelValue"],Qe={class:"file-upload-label"},Re=["onChange"],Be={key:0,class:"file-name-display"},Ve=["src"],He={key:2,class:"comment-error"},Je={class:"rightbar"},We={class:"groups-section"},Ke={class:"groups-header"},ze={class:"groups-list"},Ye=["onClick"],Ze={class:"group-info"},et={class:"group-details"},tt={class:"group-title"},ot={class:"group-desc"},st={key:0,class:"owner-badge"},it=["onClick"],at=["onClick"],nt=["onClick"],rt=["onClick"],ct={class:"users-section"},lt={class:"users-list"},ut=["src","onClick"],dt=["onClick"],ht={key:0,class:"modal-overlay"},pt={class:"modal-content create-group-modal"},mt={class:"form-group"},gt={class:"form-group"},kt={class:"modal-buttons"},ft={class:"chat-modal"},vt={class:"chat-modal-header"},wt={class:"chat-users-list"},bt=["onClick"],yt=["src","alt"],Lt={key:0,class:"chat-messages-area"},Ct={class:"chat-messages-title"},Et={class:"chat-messages-list"},_t={class:"chat-msg-time"},Nt={key:1,class:"chat-no-user"};function Pt(e,t,o,a,n,c){return(0,i.uX)(),(0,i.CE)("div",Q,[(0,i.Lk)("aside",R,[(0,i.Lk)("div",B,[t[27]||(t[27]=(0,i.Lk)("div",{class:"sidebar-icon active",title:"Home"},[(0,i.Lk)("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M3 12L12 3l9 9"}),(0,i.Lk)("path",{d:"M9 21V9h6v12"})])],-1)),(0,i.Lk)("div",{class:"sidebar-icon",title:"Profile",onClick:t[0]||(t[0]=(...e)=>c.goToProfile&&c.goToProfile(...e))},t[21]||(t[21]=[(0,i.Lk)("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("circle",{cx:"12",cy:"8",r:"4"}),(0,i.Lk)("path",{d:"M4 21v-2a4 4 0 014-4h8a4 4 0 014 4v2"})],-1)])),(0,i.Lk)("div",{class:"sidebar-icon",title:"Groups",onClick:t[1]||(t[1]=(...e)=>c.goToMyGroups&&c.goToMyGroups(...e))},t[22]||(t[22]=[(0,i.Fv)('<svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" data-v-96c46184><path d="M17 21v-2a4 4 0 00-4-4H7a4 4 0 00-4 4v2" data-v-96c46184></path><circle cx="9" cy="7" r="4" data-v-96c46184></circle><path d="M23 21v-2a4 4 0 00-3-3.87" data-v-96c46184></path><path d="M16 3.13a4 4 0 010 7.75" data-v-96c46184></path></svg>',1)])),(0,i.Lk)("div",{class:"sidebar-icon",title:"Settings",onClick:t[2]||(t[2]=t=>e.$router.push("/settings"))},t[23]||(t[23]=[(0,i.Lk)("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("circle",{cx:"12",cy:"12",r:"3"}),(0,i.Lk)("path",{d:"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09a1.65 1.65 0 00-1-1.51 1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09a1.65 1.65 0 001.51-1 1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06a1.65 1.65 0 001.82.33h.09A1.65 1.65 0 0011 3.09V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51h.09a1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06a1.65 1.65 0 00-.33 1.82v.09A1.65 1.65 0 0020.91 11H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"})],-1)])),(0,i.Lk)("div",{class:"sidebar-icon",ref:"notifBtn",title:"Notifications",onClick:t[3]||(t[3]=(...e)=>c.handleNotifClick&&c.handleNotifClick(...e))},[t[24]||(t[24]=(0,i.Lk)("svg",{width:"22",height:"22",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M18 8a6 6 0 10-12 0c0 7-3 9-3 9h18s-3-2-3-9"}),(0,i.Lk)("path",{d:"M13.73 21a2 2 0 01-3.46 0"})],-1)),c.unreadNotificationCount>0?((0,i.uX)(),(0,i.CE)("span",V,(0,r.v_)(c.unreadNotificationCount),1)):(0,i.Q3)("",!0)],512),n.showNotifications?((0,i.uX)(),(0,i.CE)("div",H,[t[25]||(t[25]=(0,i.Lk)("div",{class:"notif-popup-header"},"Notifications",-1)),(0,i.Lk)("ul",J,[n.notifications&&0!==n.notifications.length?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("li",W,"No notifications yet.")),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.notifications||[],(e=>((0,i.uX)(),(0,i.CE)("li",{key:e.time+e.sender,class:(0,r.C4)(["notif-item",{unread:!e.is_read}]),onClick:t=>c.markNotificationAsRead(e.id)},[(0,i.Lk)("span",z,[(0,i.Lk)("b",null,(0,r.v_)(e.sender),1),"message"===e.type?((0,i.uX)(),(0,i.CE)("span",Y,"sent you a message: "+(0,r.v_)(e.text&&e.text.length>40?e.text.slice(0,40)+"…":e.text),1)):((0,i.uX)(),(0,i.CE)("span",Z,(0,r.v_)(e.text),1))]),(0,i.Lk)("span",ee,(0,r.v_)(c.formatTimestamp(e.time)),1)],10,K)))),128))])],512)):(0,i.Q3)("",!0),(0,i.Lk)("div",{class:"sidebar-icon",onClick:t[4]||(t[4]=(...e)=>c.logout&&c.logout(...e))},t[26]||(t[26]=[(0,i.Lk)("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M17 16l4-4m0 0l-4-4m4 4H7"}),(0,i.Lk)("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"})],-1)]))])]),(0,i.Lk)("div",te,[(0,i.Lk)("div",oe,[(0,i.Lk)("div",se,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.otherUsers,(e=>((0,i.uX)(),(0,i.CE)("div",{key:e.name,class:"avatar-item"},[(0,i.Lk)("img",{src:e.avatar,alt:e.name,onClick:t=>c.gotoxprofile(e.username)},null,8,ie),(0,i.Lk)("span",ae,(0,r.v_)(e.name.split(" ")[0]),1)])))),128))])]),(0,i.Lk)("div",ne,[(0,i.Lk)("img",{class:"profile-pic",src:n.user.avatar,alt:"Profile"},null,8,re),(0,i.Lk)("form",{class:"create-post-form",onSubmit:t[10]||(t[10]=(0,s.D$)(((...e)=>c.submitPost&&c.submitPost(...e)),["prevent"]))},[(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>n.newPost.title=e),placeholder:"What's on your mind?",required:""},null,512),[[s.Jo,n.newPost.title]]),(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":t[6]||(t[6]=e=>n.newPost.content=e),placeholder:"Share your thoughts...",required:""},null,512),[[s.Jo,n.newPost.content]]),(0,i.Lk)("label",ce,[t[28]||(t[28]=(0,i.Lk)("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),(0,i.Lk)("polyline",{points:"17 8 12 3 7 8"}),(0,i.Lk)("line",{x1:"12",y1:"3",x2:"12",y2:"15"})],-1)),t[29]||(t[29]=(0,i.eW)(" Upload Image ")),(0,i.Lk)("input",{type:"file",onChange:t[7]||(t[7]=(...e)=>c.handleImageUpload&&c.handleImageUpload(...e)),accept:"image/*"},null,32)]),n.imagePreview?((0,i.uX)(),(0,i.CE)("img",{key:0,src:n.imagePreview,class:"image-preview",alt:"Preview"},null,8,le)):(0,i.Q3)("",!0),(0,i.Lk)("div",ue,[(0,i.Lk)("div",de,[(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>n.newPost.status=e),required:""},t[30]||(t[30]=[(0,i.Lk)("option",{value:"public"},"Public",-1),(0,i.Lk)("option",{value:"private"},"Private",-1),(0,i.Lk)("option",{value:"semi-private"},"Semi-Private",-1)]),512),[[s.u1,n.newPost.status]])])]),"semi-private"===n.newPost.status?((0,i.uX)(),(0,i.CE)("div",he,[0===n.allowedUsers.length?((0,i.uX)(),(0,i.CE)("div",pe,"No User is following you!")):((0,i.uX)(!0),(0,i.CE)(i.FK,{key:1},(0,i.pI)(n.allowedUsers,(e=>((0,i.uX)(),(0,i.CE)("label",{key:e.username,class:"allowed-user-pill"},[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=e=>n.selectedAllowedUsers=e),value:e.username},null,8,me),[[s.lH,n.selectedAllowedUsers]]),(0,i.Lk)("span",ge,[n.selectedAllowedUsers.includes(e.username)?((0,i.uX)(),(0,i.CE)("svg",ke,t[31]||(t[31]=[(0,i.Lk)("circle",{cx:"9",cy:"9",r:"9",fill:"#4f46e5"},null,-1),(0,i.Lk)("path",{d:"M5 9l3 3 5-5",stroke:"#fff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):((0,i.uX)(),(0,i.CE)("svg",fe,t[32]||(t[32]=[(0,i.Lk)("circle",{cx:"9",cy:"9",r:"9",fill:"#e5e7eb"},null,-1)])))]),(0,i.Lk)("img",{src:e.avatar,alt:e.username,class:"allowed-user-avatar"},null,8,ve),(0,i.Lk)("span",we,(0,r.v_)(e.username),1)])))),128))])):(0,i.Q3)("",!0),t[33]||(t[33]=(0,i.Lk)("button",{class:"post-btn",type:"submit"},"Post",-1)),n.message?((0,i.uX)(),(0,i.CE)("div",be,(0,r.v_)(n.message),1)):(0,i.Q3)("",!0)],32)]),(0,i.Lk)("div",ye,[0===n.posts.length?((0,i.uX)(),(0,i.CE)("div",Le,"No posts available. Be the first to post!")):((0,i.uX)(!0),(0,i.CE)(i.FK,{key:1},(0,i.pI)(n.posts,(e=>((0,i.uX)(),(0,i.CE)("div",{class:"post-card",key:e.ID},[e.imageUrl?((0,i.uX)(),(0,i.CE)("div",Ce,[(0,i.Lk)("img",{src:e.imageUrl,alt:"Post image"},null,8,Ee)])):(0,i.Q3)("",!0),(0,i.Lk)("div",_e,[(0,i.Lk)("img",{class:"post-author-pic",src:e.authorAvatar,alt:"Author"},null,8,Ne),(0,i.Lk)("div",null,[(0,i.Lk)("h4",null,(0,r.v_)(e.Author),1),(0,i.Lk)("p",Pe,(0,r.v_)(c.formatTimestamp(e.Creation_date)),1)])]),(0,i.Lk)("h3",Ie,(0,r.v_)(e.Title),1),(0,i.Lk)("p",Me,(0,r.v_)(e.Content),1),e.Image?((0,i.uX)(),(0,i.CE)("img",{key:1,class:"post-image",src:e.Image,alt:"Post Image"},null,8,Fe)):(0,i.Q3)("",!0),(0,i.Lk)("div",Te,[(0,i.Lk)("span",{class:"icon-btn",onClick:t=>c.toggleComments(e)},t[34]||(t[34]=[(0,i.Lk)("svg",{width:"22",height:"22",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"})],-1)]),8,$e)]),e.showComments?((0,i.uX)(),(0,i.CE)("div",xe,[0===e.comments.length?((0,i.uX)(),(0,i.CE)("div",Xe,"No comments yet. Be the first to comment!")):((0,i.uX)(!0),(0,i.CE)(i.FK,{key:1},(0,i.pI)(e.comments,(e=>((0,i.uX)(),(0,i.CE)("div",{class:"comment",key:e.id},[(0,i.Lk)("div",Ue,[(0,i.Lk)("img",{class:"comment-author-pic",src:e.avatar,alt:"Comment Author"},null,8,Se),(0,i.Lk)("div",null,[(0,i.Lk)("h5",null,(0,r.v_)(e.Author),1),(0,i.Lk)("p",je,(0,r.v_)(c.formatTimestamp(e.creation_date)),1)])]),(0,i.Lk)("p",Ae,(0,r.v_)(e.comment),1),e.image?((0,i.uX)(),(0,i.CE)("img",{key:0,class:"comment-image",src:e.image,alt:"Comment Image"},null,8,Ge)):(0,i.Q3)("",!0)])))),128)),(0,i.Lk)("form",{onSubmit:(0,s.D$)((t=>c.addComment(e)),["prevent"]),class:"comment-form"},[(0,i.Lk)("div",Oe,[(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":t=>e.newComment=t,placeholder:"Add a comment...",required:""},null,8,qe),[[s.Jo,e.newComment]]),(0,i.Lk)("label",Qe,[t[35]||(t[35]=(0,i.Lk)("svg",{width:"18",height:"18",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),(0,i.Lk)("polyline",{points:"17 8 12 3 7 8"}),(0,i.Lk)("line",{x1:"12",y1:"3",x2:"12",y2:"15"})],-1)),(0,i.Lk)("input",{type:"file",onChange:t=>c.handleImageUpload(t,e.Id),accept:"image/*"},null,40,Re)]),t[36]||(t[36]=(0,i.Lk)("button",{type:"submit",class:"comment-submit-btn",title:"Add Comment"},[(0,i.Lk)("svg",{width:"22",height:"22",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"})])],-1))]),n.commentImages[e.Id]&&n.commentImages[e.Id].fileName?((0,i.uX)(),(0,i.CE)("div",Be," Selected file: "+(0,r.v_)(n.commentImages[e.Id].fileName),1)):(0,i.Q3)("",!0),n.commentImages[e.Id]&&n.commentImages[e.Id].preview?((0,i.uX)(),(0,i.CE)("img",{key:1,src:n.commentImages[e.Id].preview,class:"image-preview",alt:"Preview"},null,8,Ve)):(0,i.Q3)("",!0),e.commentError?((0,i.uX)(),(0,i.CE)("div",He,(0,r.v_)(e.commentError),1)):(0,i.Q3)("",!0)],40,De)])):(0,i.Q3)("",!0)])))),128))])]),(0,i.Lk)("aside",Je,[(0,i.Lk)("div",We,[(0,i.Lk)("div",Ke,[t[38]||(t[38]=(0,i.Lk)("span",null,"Groups",-1)),(0,i.Lk)("button",{class:"create-group-btn",onClick:t[11]||(t[11]=e=>n.showCreateGroup=!0),title:"Create Group"},t[37]||(t[37]=[(0,i.Lk)("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("circle",{cx:"12",cy:"12",r:"10"}),(0,i.Lk)("path",{d:"M12 8v8M8 12h8"})],-1)]))]),(0,i.Lk)("ul",ze,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.groups,(e=>((0,i.uX)(),(0,i.CE)("li",{key:e.id,class:"group-list-item group-clickable",onClick:t=>c.goToGroup(e.id)},[(0,i.Lk)("div",Ze,[t[39]||(t[39]=(0,i.Fv)('<span class="group-avatar" data-v-96c46184><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" data-v-96c46184><path d="M17 21v-2a4 4 0 00-4-4H7a4 4 0 00-4 4v2" data-v-96c46184></path><circle cx="9" cy="7" r="4" data-v-96c46184></circle><path d="M23 21v-2a4 4 0 00-3-3.87" data-v-96c46184></path><path d="M16 3.13a4 4 0 010 7.75" data-v-96c46184></path></svg></span>',1)),(0,i.Lk)("div",et,[(0,i.Lk)("span",tt,(0,r.v_)(e.name),1),(0,i.Lk)("span",ot,(0,r.v_)(e.description),1),e.is_owner?((0,i.uX)(),(0,i.CE)("span",st,"Owner")):(0,i.Q3)("",!0)])]),"accepted"!=e.member_status||e.is_owner?"pending"!=e.member_status||e.is_owner?"invited"!=e.member_status||e.is_owner?e.is_owner?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("button",{key:3,class:"follow-btn",onClick:(0,s.D$)((t=>c.toggleJoin(e)),["stop"])}," Join ",8,rt)):((0,i.uX)(),(0,i.CE)("button",{key:2,class:"pending-btn",onClick:(0,s.D$)((t=>c.toggleJoin(e)),["stop"])}," Accept Invitation ",8,nt)):((0,i.uX)(),(0,i.CE)("button",{key:1,class:"pending-btn",onClick:(0,s.D$)((t=>c.toggleJoin(e)),["stop"])}," Cancel Request ",8,at)):((0,i.uX)(),(0,i.CE)("button",{key:0,class:"followed-btn",onClick:(0,s.D$)((t=>c.toggleJoin(e)),["stop"])}," Leave ",8,it))],8,Ye)))),128))])]),(0,i.Lk)("div",ct,[t[40]||(t[40]=(0,i.Lk)("div",{class:"users-header"},[(0,i.Lk)("span",null,"Followed Users: ")],-1)),(0,i.Lk)("ul",lt,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.followedUsers,(e=>((0,i.uX)(),(0,i.CE)("li",{key:e.name,class:"user-list-item"},[(0,i.Lk)("img",{class:"mini-profile-pic",src:e.avatar,alt:"User",onClick:t=>c.gotoxprofile(e.username)},null,8,ut),(0,i.Lk)("span",{class:"user-name",onClick:t=>c.gotoxprofile(e.username)},(0,r.v_)(e.name),9,dt)])))),128))])])]),n.showCreateGroup?((0,i.uX)(),(0,i.CE)("div",ht,[(0,i.Lk)("div",pt,[t[44]||(t[44]=(0,i.Lk)("h3",null,"Create New Group",-1)),(0,i.Lk)("form",{onSubmit:t[15]||(t[15]=(0,s.D$)(((...e)=>c.createGroup&&c.createGroup(...e)),["prevent"]))},[(0,i.Lk)("div",mt,[t[41]||(t[41]=(0,i.Lk)("label",{for:"groupTitle"},"Group Title",-1)),(0,i.bo)((0,i.Lk)("input",{id:"groupTitle","onUpdate:modelValue":t[12]||(t[12]=e=>n.newGroup.title=e),type:"text",required:"",placeholder:"Enter group title"},null,512),[[s.Jo,n.newGroup.title]])]),(0,i.Lk)("div",gt,[t[42]||(t[42]=(0,i.Lk)("label",{for:"groupDescription"},"Description",-1)),(0,i.bo)((0,i.Lk)("textarea",{id:"groupDescription","onUpdate:modelValue":t[13]||(t[13]=e=>n.newGroup.description=e),required:"",placeholder:"Enter group description"},null,512),[[s.Jo,n.newGroup.description]])]),(0,i.Lk)("div",kt,[t[43]||(t[43]=(0,i.Lk)("button",{type:"submit",class:"submit-btn"},"Create Group",-1)),(0,i.Lk)("button",{type:"button",class:"cancel-btn",onClick:t[14]||(t[14]=e=>n.showCreateGroup=!1)}," Cancel ")])],32)])])):(0,i.Q3)("",!0),(0,i.Lk)("button",{class:"chat-fab",onClick:t[16]||(t[16]=(...e)=>c.handleChatClick&&c.handleChatClick(...e)),title:"Open Chat"},t[45]||(t[45]=[(0,i.Lk)("svg",{width:"28",height:"28",fill:"none",stroke:"currentColor","stroke-width":"2.2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"})],-1)])),n.isChatExpanded?((0,i.uX)(),(0,i.CE)("div",{key:1,class:"chat-modal-overlay",onClick:t[20]||(t[20]=(0,s.D$)((e=>n.isChatExpanded=!1),["self"]))},[(0,i.Lk)("div",ft,[(0,i.Lk)("div",vt,[t[46]||(t[46]=(0,i.Lk)("span",null,"Chat",-1)),(0,i.Lk)("button",{class:"chat-modal-close",onClick:t[17]||(t[17]=e=>n.isChatExpanded=!1)},"×")]),(0,i.Lk)("div",wt,[t[47]||(t[47]=(0,i.Lk)("div",{class:"chat-users-title"},"Chat Users",-1)),(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.chatUsers,(e=>((0,i.uX)(),(0,i.CE)("li",{key:e.name,onClick:t=>c.selectChatUser(e),class:(0,r.C4)({selected:n.selectedChatUser&&n.selectedChatUser.name===e.name})},[(0,i.Lk)("img",{src:e.avatar,alt:e.name,class:"chat-user-avatar"},null,8,yt),(0,i.Lk)("span",null,(0,r.v_)(e.fullname),1)],10,bt)))),128))])]),n.selectedChatUser?((0,i.uX)(),(0,i.CE)("div",Lt,[(0,i.Lk)("div",Ct,"Chat with "+(0,r.v_)(n.selectedChatUser.name),1),(0,i.Lk)("div",Et,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.selectedChatUser.messages,(e=>((0,i.uX)(),(0,i.CE)("div",{key:e.id,class:(0,r.C4)(["chat-msg","self"===e.sender?"self":"other"])},[(0,i.Lk)("span",null,(0,r.v_)(e.text),1),(0,i.Lk)("span",_t,(0,r.v_)(c.formatTimestamp(e.timestamp)),1)],2)))),128))]),(0,i.Lk)("form",{class:"chat-send-form",onSubmit:t[19]||(t[19]=(0,s.D$)(((...e)=>c.sendMessage&&c.sendMessage(...e)),["prevent"]))},[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[18]||(t[18]=e=>n.newMessage=e),placeholder:"Type a message...",required:""},null,512),[[s.Jo,n.newMessage]]),t[48]||(t[48]=(0,i.Lk)("button",{type:"submit",class:"chat-send-btn",title:"Send"},[(0,i.Lk)("svg",{width:"22",height:"22",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),(0,i.Lk)("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})])],-1))],32)])):((0,i.uX)(),(0,i.CE)("div",Nt,"Select a user to start chatting"))])])):(0,i.Q3)("",!0)])}o(8111),o(2489),o(116),o(7588),o(1701);var It={props:["showNotification"],name:"ForumPage",data(){return{user:{avatar:"",name:"",email:"",username:"guest"},socket:null,newPost:{author:"",title:"",content:"",image:"",status:"public"},image:null,imagePreview:null,imageFileName:"",posts:[],message:"",allowedUsers:[],selectedAllowedUsers:[],groups:[],otherUsers:[],followedUsers:[],isChatExpanded:!1,newMessage:"",selectedChatUser:null,chatUsers:[],currentMessage:{type:"",message:"",receiver:"",username:""},showCreateGroup:!1,newGroup:{title:"",description:"",creator_id:null},groupMembership:{},postsPrvMap:{},showNotifications:!1,notifications:[],commentImages:{}}},beforeRouteEnter(e,t,o){fetch("https://back-production-bb9b.up.railway.app//api/info",{method:"GET",credentials:"include"}).then((e=>{e.ok?o():o("/login")})).catch((()=>{o("/login")}))},async created(){this.$router.push("/home");try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/info",{method:"GET",credentials:"include"}),t=await e.json();console.log("userData",t),this.user.name=t.Username,this.user.email=t.Email,this.user.username=t.Username.toLowerCase(),t.Avatar?this.user.avatar=`https://back-production-bb9b.up.railway.app//uploads/${t.Avatar}`:this.user.avatar=`https://api.dicebear.com/7.x/avataaars/svg?seed=${t.Username}`,this.initializeWebSocket(),await this.fetchPostsPrv(),await this.fetchPosts(),await this.fetchAllUsers(),await this.fetchAllowedUsers(),await this.fetchGroups(),await this.fetchNotifications()}catch(e){console.error("Initialization failed:",e),this.$router.push("/login")}},methods:{async fetchAllowedUsers(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/postsprivacy",{method:"GET",credentials:"include"});if(e.ok){const t=await e.json();if(!t.followers)return;console.log("Allowed users data:",t),this.allowedUsers=t.followers.map((e=>({username:e,avatar:`https://api.dicebear.com/7.x/avataaars/svg?seed=${e}`})))}else this.showNotification("Failed to fetch allowed users","error"),console.error("Failed to fetch allowed users")}catch(e){this.showNotification("Failed to fetch allowed users","error"),console.error("Error fetching allowed users:",e)}console.log("Allowed users:",this.allowedUsers)},async fetchAllUsers(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/allusers",{method:"GET",credentials:"include"});if(e.ok){const t=await e.json();if(!t||0===t.length)return;console.log("All users data:",t),this.otherUsers=t.map((e=>({name:e.fullname,username:e.username,avatar:e.avatar?`https://back-production-bb9b.up.railway.app//uploads/${e.avatar}`:`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.username}`,followed:e.followed||!1}))),this.followedUsers=this.otherUsers.filter((e=>e.followed)),console.log("Followed users:",this.followedUsers)}const t=await fetch("https://back-production-bb9b.up.railway.app//api/openchat",{method:"GET",credentials:"include"});if(t.ok){const e=await t.json();if(console.log("Chat users data:",e),!e||0===e.length)return;this.chatUsers=e.map((e=>({id:e.id,fullname:e.full_name,name:e.username,messages:[],avatar:e.avatar?`https://back-production-bb9b.up.railway.app//uploads/${e.avatar}`:`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.username}`})))}else this.showNotification("Failed to fetch chat users","error"),console.error("Failed to fetch chat users")}catch(e){this.showNotification("Failed to fetch chat users","error"),console.error("Error fetching users:",e)}},initializeWebSocket(){this.socket=new WebSocket(`ws://${(void 0).VITE_API_URL.replace("http://","")}/ws`),this.socket.onmessage=e=>{const t=JSON.parse(e.data);"message"==t.type&&this.showNotification("New message from "+t.username,"success"),console.log("Received message:",t);const o=this.chatUsers.find((e=>e.name===t.username));o&&(this.showNotification("New message from "+t.username,"success"),o.messages.push({id:Date.now(),text:t.message,sender:"other",timestamp:(new Date).toISOString()}))},this.socket.onopen=()=>{console.log("WebSocket connected")},this.socket.onerror=e=>{console.error("WebSocket error:",e)},this.socket.onclose=()=>{console.log("WebSocket disconnected")}},async fetchPosts(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/getposts",{method:"GET",credentials:"include"});if(e.ok){const t=await e.json();if(console.log("data",t),!t)return;this.posts=t.map((e=>({...e,authorAvatar:e.Avatar?`https://back-production-bb9b.up.railway.app//uploads/${e.Avatar}`:`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.Author}`,Image:e.Image,comments:[],newComment:"",showComments:!1,commentError:""})))}else this.showNotification("Failed to fetch posts","error"),console.error("Failed to fetch posts")}catch(e){this.showNotification("Failed to fetch posts","error"),console.error("Error fetching posts:",e)}},async fetchComments(e){try{const t=await fetch(`https://back-production-bb9b.up.railway.app//api/getcomments?post_id=${e.Id}`,{method:"GET",credentials:"include"});if(t.ok){const o=await t.json();if(console.log(o),!o)return;e.comments=o.map((e=>({...e,avatar:e.avatar?`https://back-production-bb9b.up.railway.app//uploads/${e.avatar}`:`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.author}`,image:e.image?`https://back-production-bb9b.up.railway.app//uploads/${e.image}`:null})))}else this.showNotification("Failed to fetch comments","error"),console.error("Failed to fetch comments for post",e.ID),e.commentError="Failed to load comments."}catch(t){this.showNotification("Failed to fetch comments","error"),console.error("Error fetching comments:",t)}},async addComment(e){if(!e.newComment.trim())return void(e.commentError="Comment cannot be empty.");if(e.newComment.trim().length<1)return void(e.commentError="Comment must be at least 1 character long.");if(e.newComment.trim().length>500)return void(e.commentError="Comment must not exceed 500 characters.");const t=new FormData;t.append("post_id",e.Id.toString()),t.append("comment",e.newComment.trim()),this.commentImages[e.Id]&&this.commentImages[e.Id].file&&t.append("image",this.commentImages[e.Id].file);try{const o=await fetch("https://back-production-bb9b.up.railway.app//api/addcomments",{method:"POST",credentials:"include",body:t});o.ok?(e.commentError="",e.newComment="",this.commentImages[e.Id]=null,this.showNotification("Comment added successfully","success"),await this.fetchComments(e)):(this.showNotification("Failed to add comment","error"),console.error("Failed to add comment"),e.commentError="Failed to add comment.")}catch(o){this.showNotification("Failed to add comment","error"),console.error("Error adding comment:",o),e.commentError="Error adding comment."}},async submitPost(){if(this.newPost.title.length<1)return this.message="Title must be at least 1 characters long.",void this.showNotification("Title must be at least 1 characters long.","error");if(this.newPost.title.length>50)return this.message="Title must not exceed 50 characters.",void this.showNotification("Title must not exceed 100 characters.","error");if(this.newPost.content.length<1)return this.message="Content must be at least 1 characters long.",void this.showNotification("Content must be at least 10 characters long.","error");if(this.newPost.content.length>1e3)return this.message="Content must not exceed 1000 characters.",void this.showNotification("Content must not exceed 1000 characters.","error");try{const e=new FormData;e.append("title",this.newPost.title),e.append("content",this.newPost.content),e.append("status",this.newPost.status),e.append("allowed_users",this.selectedAllowedUsers.join(",")),this.image&&e.append("image",this.image);const t=await fetch("https://back-production-bb9b.up.railway.app//api/posts",{method:"POST",credentials:"include",body:e});console.log(this.selectedAllowedUsers),t.ok?(this.message="Post created successfully!",this.newPost={title:"",content:"",status:"public"},this.selectedAllowedUsers=[],this.image=null,this.imagePreview=null,this.imageFileName="",this.showNotification("Post created successfully!","success"),await this.fetchPosts()):this.showNotification("Failed to create post","error")}catch(e){this.showNotification("Failed to create post","error"),console.error("Post creation failed:",e),this.message="Error submitting post."}},logout(){fetch("https://back-production-bb9b.up.railway.app//api/auth/logout",{method:"POST",credentials:"include"}).then((e=>{e.ok?(this.showNotification("Logged out successfully","success"),this.$router.push("/login")):(this.showNotification("Failed to logout","error"),this.$router.push("/login"))})).catch((e=>{this.showNotification("Failed to logout","error"),console.error("Logout error:",e),this.$router.push("/login")}))},gotoxprofile(e){this.$router.push(`/profile/${e}`)},async toggleJoin(e){try{if(!e||!e.id)return void console.warn("toggleJoin called with invalid group");const t=await fetch("https://back-production-bb9b.up.railway.app//api/info",{method:"GET",credentials:"include"});if(!t.ok)return void this.showNotification("Failed to get user information","error");const o=await t.json();let s,i,a={};"accepted"===e.member_status?(s="https://back-production-bb9b.up.railway.app//api/removememberfromgroup",i="leave",a={group_id:e.id,user_id:o.id}):"pending"===e.member_status?(s="https://back-production-bb9b.up.railway.app//api/cancelgrouprequest",i="cancel request from",a={group_id:e.id}):"invited"===e.member_status?(s="https://back-production-bb9b.up.railway.app//api/acceptgroupinvite",i="accept invitation to",a={group_id:e.id,action:"accept"}):(s="https://back-production-bb9b.up.railway.app//api/requesttojoingroup",i="join",a={group_id:e.id});const n=await fetch(s,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(n.ok)"accepted"===e.member_status?(e.member_status=null,this.showNotification("Left group successfully","success")):"pending"===e.member_status?(e.member_status=null,this.showNotification("Request cancelled successfully","success")):"invited"===e.member_status?(e.member_status="accepted",this.showNotification("Invitation accepted successfully","success")):(e.member_status="pending",this.showNotification("Join request sent successfully","success")),await this.fetchGroups();else{const e=await n.text();console.error(`Failed to ${i} group: ${e}`),this.showNotification(`Failed to ${i} group`,"error")}}catch(t){console.error("Error updating group membership:",t),this.showNotification("Failed to update group membership","error")}},goToProfile(){this.$router.push(`/profile/${this.user.username}`)},goToMyGroups(){this.$router.push("/mygroups")},goToGroup(e){this.$router.push(`/group/${e}`)},toggleChat(){this.isChatExpanded=!this.isChatExpanded},selectChatUser(e){console.log("user",e.name),this.selectedChatUser=e.name,console.log("selectedChatUser",this.selectedChatUser),this.fetchMessages(this.selectedChatUser)},async fetchMessages(e){console.log("Fetching messages for use11:",e);try{const t=await fetch(`https://back-production-bb9b.up.railway.app//api/getmessages?sender=${this.user.username}&receiver=${e}`,{method:"GET",credentials:"include"});if(t.ok){const o=await t.json();console.log("Fetched messages:",o);const s=this.chatUsers.find((t=>t.name===e));if(!s)return void console.error("Chat user not found");s.messages=[],o&&Array.isArray(o)&&(s.messages=o.map((e=>({id:Date.now()+Math.random(),text:e.message,sender:e.username===this.user.username?"self":"other",timestamp:e.time}))),s.messages.sort(((e,t)=>new Date(e.timestamp)-new Date(t.timestamp)))),this.selectedChatUser=s}else console.error("Failed to fetch messages"),this.showNotification("Failed to load messages","error")}catch(t){console.error("Error fetching messages:",t),this.showNotification("Error loading messages","error")}},sendMessage(){this.newMessage.trim()&&this.selectedChatUser&&(this.currentMessage.type="message",this.currentMessage.receiver=this.selectedChatUser.name,this.currentMessage.username=this.user.username,this.currentMessage.message=this.newMessage,this.socket&&this.socket.send(JSON.stringify(this.currentMessage)),this.selectedChatUser.messages.push({text:this.newMessage,sender:"self",timestamp:Date.now()}),console.log("sasa",Date.now().toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})),this.newMessage="")},formatTimestamp(e){return new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})},toggleComments(e){e.showComments=!e.showComments,e.showComments&&0===e.comments.length&&this.fetchComments(e)},getMessageClass(e){return"self"===e.sender?"self":"other"},async fetchGroups(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/getgroups",{method:"GET",credentials:"include"});if(e.ok){const t=await e.json();if(!t)return;console.log("Fetched groups data:",t),this.groups=t.map((e=>({id:e.id,owner:e.creator_id,is_owner:e.is_owner,name:e.title,description:e.description,member_status:e.member_status}))),console.log("Fetched groups:",this.groups);for(const e of this.groups)await this.checkGroupMembership(e.id)}else this.showNotification("Failed to fetch groups","error"),console.error("Failed to fetch groups")}catch(e){this.showNotification("Failed to fetch groups","error"),console.error("Error fetching groups:",e)}},async checkGroupMembership(e){try{if(!e)return void console.warn("checkGroupMembership called with invalid groupId");const t=await fetch(`https://back-production-bb9b.up.railway.app//api/ismember?group_id=${e}`,{method:"GET",credentials:"include"});if(!t.ok){const e=await t.text();return console.error(`Failed to check group membership: ${e}`),void this.showNotification("Failed to check group membership","error")}const o=await t.json();o&&"undefined"!==typeof o.is_member?this.groupMembership[e]=o.is_member:(console.warn("Received invalid data format from server"),this.groupMembership[e]=!1)}catch(t){console.error("Error checking group membership:",t),this.showNotification("Failed to check group membership","error")}},async createGroup(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/info",{method:"GET",credentials:"include"});if(!e.ok)return void this.showNotification("Failed to get user information","error");const t=await e.json();this.newGroup.creator_id=t.id;const o=await fetch("https://back-production-bb9b.up.railway.app//api/creategroups",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.newGroup)});if(o.ok){this.showNotification("Group created successfully","success");const e=await o.json();this.groups.push({id:e.id,name:e.title,owner:this.user.username,is_owner:!0,member_status:"accepted",description:e.description}),this.showCreateGroup=!1,this.newGroup={title:"",description:"",creator_id:null}}else this.showNotification("Failed to create group","error"),console.error("Failed to create group")}catch(e){this.showNotification("Failed to create group","error"),console.error("Error creating group:",e)}},async fetchPostsPrv(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/postsprv",{method:"GET",credentials:"include"});if(e.ok){const t=await e.json();if(!t||0===t.length)return void console.warn("No posts privacy data found");const o={};t.forEach((e=>{const t=e.post_id.toString();o[t]||(o[t]=[]),o[t].push(e.username)})),this.postsPrvMap=o,console.log("postsPrvMap",this.postsPrvMap)}}catch(e){console.error("Error fetching postsprv:",e)}},handleNotifClick(){this.showNotifications=!this.showNotifications,this.showNotifications&&this.notifications.forEach((e=>{e.is_read||this.markNotificationAsRead(e.id)}))},handleNotifClose(e){if(!this.showNotifications)return;const t=this.$refs.notifPopup,o=this.$refs.notifBtn;t&&o&&(t.contains(e.target)||o.contains(e.target))||(this.showNotifications=!1)},async fetchNotifications(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/notifications",{method:"GET",credentials:"include"});if(e.ok){const t=await e.json();console.log("sassasaassa",t),this.notifications=Array.isArray(t)?t.map((e=>({id:e.id,sender:e.sender_username||"Unknown",text:e.content||"",time:e.time||(new Date).toISOString(),type:e.type||"notification",is_read:e.is_read||!1}))):[]}else this.notifications=[]}catch(e){console.error("Error fetching notifications:",e),this.notifications=[]}},async markNotificationAsRead(e){console.log(e);try{const t=this.notifications.find((t=>t.id===e));if(!t)return;setTimeout((async()=>{try{const o=await fetch("https://back-production-bb9b.up.railway.app//api/markasread",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({notificationId:e,is_read:1})});console.log("res",o),o.ok&&(t.is_read=!0)}catch(o){console.error("Error marking notification as read:",o)}}),3e3)}catch(t){console.error("Error marking notification as read:",t)}},handleImageUpload(e,t=null){const o=e.target.files[0];o?t?this.commentImages[t]={file:o,preview:URL.createObjectURL(o),fileName:o.name}:(this.image=o,this.imageFileName=o.name,this.imagePreview=URL.createObjectURL(o)):t?this.commentImages[t]=null:(this.image=null,this.imagePreview=null,this.imageFileName="")},formatTime(e){if(!e)return"";const t=new Date(e),o=new Date,s=o-t;if(s<6e4)return"just now";if(s<36e5){const e=Math.floor(s/6e4);return`${e}m ago`}if(s<864e5){const e=Math.floor(s/36e5);return`${e}h ago`}if(s<6048e5){const e=Math.floor(s/864e5);return`${e}d ago`}return t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},async fetchChatUsers(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/openchat",{method:"GET",credentials:"include"});if(e.ok){const t=await e.json();if(console.log("Chat users data:",t),!t||0===t.length)return;this.chatUsers=t.map((e=>({id:e.id,fullname:e.full_name,name:e.username,messages:[],avatar:e.avatar?`https://back-production-bb9b.up.railway.app//uploads/${e.avatar}`:`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.username}`})))}else this.showNotification("Failed to fetch chat users","error"),console.error("Failed to fetch chat users")}catch(e){console.error("Error fetching chat users:",e),this.showNotification("Error fetching chat users","error")}},async handleChatClick(){this.isChatExpanded||await this.fetchChatUsers(),this.isChatExpanded=!this.isChatExpanded}},mounted(){document.addEventListener("click",this.handleNotifClose)},beforeUnmount(){document.removeEventListener("click",this.handleNotifClose)},computed:{unreadNotificationCount(){return this.notifications.filter((e=>!e.is_read)).length}}};const Mt=(0,u.A)(It,[["render",Pt],["__scopeId","data-v-96c46184"]]);var Ft=Mt;function Tt(e,t,o,a,n,c){return(0,i.uX)(),(0,i.CE)("div",null,[t[3]||(t[3]=(0,i.Lk)("h1",null,"WebSocket",-1)),(0,i.Lk)("div",null,[(0,i.Lk)("div",null,"Receiver: "+(0,r.v_)(n.receiver),1)]),(0,i.Lk)("div",null,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.message=e),onKeyup:t[1]||(t[1]=(0,s.jR)(((...e)=>c.sendMessage&&c.sendMessage(...e)),["enter"])),placeholder:"Type a message..."},null,544),[[s.Jo,n.message]]),(0,i.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>c.sendMessage&&c.sendMessage(...e))},"Send")]),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.messages,((e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t},(0,r.v_)(e),1)))),128))])}var $t={data(){return{socket:null,message:"",receiver:"admin",messages:[],currentMessage:{type:"",message:"",receiver:"",username:""}}},mounted(){const e=(void 0).VITE_API_URL.replace("http","ws");this.socket=new WebSocket(`${e}/ws`),this.socket.onmessage=e=>{const t=JSON.parse(e.data);console.log(t)},this.socket.onopen=()=>{console.log("WebSocket connected")},this.socket.onerror=e=>{console.error("WebSocket error:",e)},this.socket.onclose=()=>{console.log("WebSocket disconnected")}},methods:{sendMessage(){this.socket&&""!==this.message.trim()&&(this.currentMessage.type="message",this.currentMessage.receiver=this.receiver,this.currentMessage.username="afethi",this.currentMessage.message=this.message,this.socket.send(JSON.stringify(this.currentMessage)),this.messages.push(`Sent: ${this.message}`),this.message="")}}};const xt=(0,u.A)($t,[["render",Tt]]);var Xt=xt;const Ut={class:"groups-layout"},St={class:"sidebar"},jt={class:"sidebar-icons"},At={key:0,class:"notif-badge"},Gt={key:0,ref:"notifPopup",class:"notif-popup"},Dt={class:"notif-list"},Ot={key:0,class:"notif-item empty"},qt=["onClick"],Qt={class:"notif-text"},Rt={class:"notif-time"},Bt={class:"groups-main-content"},Vt={class:"groups-card-wrapper"},Ht={key:0,class:"no-groups"},Jt={key:1,class:"groups-grid"},Wt={class:"group-info"},Kt=["onClick"],zt={class:"group-actions"},Yt=["onClick"],Zt=["onClick"],eo={key:0,class:"pending-invitations"},to={class:"invitations-list"},oo={class:"invitation-info"},so={class:"inviter"},io={class:"invitation-actions"},ao=["onClick"],no=["onClick"];function ro(e,t,o,s,a,n){return(0,i.uX)(),(0,i.CE)("div",Ut,[(0,i.Lk)("aside",St,[(0,i.Lk)("div",jt,[(0,i.Lk)("div",{class:"sidebar-icon",title:"Home",onClick:t[0]||(t[0]=(...e)=>n.goToHome&&n.goToHome(...e))},t[8]||(t[8]=[(0,i.Lk)("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M3 12L12 3l9 9"}),(0,i.Lk)("path",{d:"M9 21V9h6v12"})],-1)])),(0,i.Lk)("div",{class:"sidebar-icon",title:"Profile",onClick:t[1]||(t[1]=(...e)=>n.goToProfile&&n.goToProfile(...e))},t[9]||(t[9]=[(0,i.Lk)("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("circle",{cx:"12",cy:"8",r:"4"}),(0,i.Lk)("path",{d:"M4 21v-2a4 4 0 014-4h8a4 4 0 014 4v2"})],-1)])),(0,i.Lk)("div",{class:"sidebar-icon active",title:"Groups",onClick:t[2]||(t[2]=t=>e.$router.push("/mygroups"))},t[10]||(t[10]=[(0,i.Fv)('<svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" data-v-5c344626><path d="M17 21v-2a4 4 0 00-4-4H7a4 4 0 00-4 4v2" data-v-5c344626></path><circle cx="9" cy="7" r="4" data-v-5c344626></circle><path d="M23 21v-2a4 4 0 00-3-3.87" data-v-5c344626></path><path d="M16 3.13a4 4 0 010 7.75" data-v-5c344626></path></svg>',1)])),(0,i.Lk)("div",{class:"sidebar-icon",ref:"notifBtn",title:"Notifications",onClick:t[3]||(t[3]=(...e)=>n.handleNotifClick&&n.handleNotifClick(...e))},[t[11]||(t[11]=(0,i.Lk)("svg",{width:"22",height:"22",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M18 8a6 6 0 10-12 0c0 7-3 9-3 9h18s-3-2-3-9"}),(0,i.Lk)("path",{d:"M13.73 21a2 2 0 01-3.46 0"})],-1)),a.unreadNotificationCount>0?((0,i.uX)(),(0,i.CE)("span",At,(0,r.v_)(a.unreadNotificationCount),1)):(0,i.Q3)("",!0)],512),a.showNotifications?((0,i.uX)(),(0,i.CE)("div",Gt,[t[12]||(t[12]=(0,i.Lk)("div",{class:"notif-popup-header"},"Notifications",-1)),(0,i.Lk)("ul",Dt,[a.notifications&&0!==a.notifications.length?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("li",Ot," No notifications yet. ")),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.notifications||[],(e=>((0,i.uX)(),(0,i.CE)("li",{key:e.id,class:(0,r.C4)(["notif-item",{unread:!e.is_read}]),onClick:t=>n.markNotificationAsRead(e.id)},[(0,i.Lk)("span",Qt,[(0,i.Lk)("b",null,(0,r.v_)(e.sender_username),1),(0,i.Lk)("span",null,(0,r.v_)(e.content),1)]),(0,i.Lk)("span",Rt,(0,r.v_)(n.formatTimestamp(e.created_at)),1)],10,qt)))),128))])],512)):(0,i.Q3)("",!0),(0,i.Lk)("div",{class:"sidebar-icon",title:"Settings",onClick:t[4]||(t[4]=t=>e.$router.push("/settings"))},t[13]||(t[13]=[(0,i.Lk)("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("circle",{cx:"12",cy:"12",r:"3"}),(0,i.Lk)("path",{d:"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09a1.65 1.65 0 00-1-1.51 1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09a1.65 1.65 0 001.51-1 1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06a1.65 1.65 0 001.82.33h.09A1.65 1.65 0 008.91 3H9a2 2 0 014 0v.09a1.65 1.65 0 001 1.51h.09a1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06a1.65 1.65 0 00-.33 1.82v.09a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"})],-1)])),(0,i.Lk)("div",{class:"sidebar-icon",title:"Logout",onClick:t[5]||(t[5]=(...e)=>n.logout&&n.logout(...e))},t[14]||(t[14]=[(0,i.Lk)("svg",{width:"22",height:"22",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M17 16l4-4m0 0l-4-4m4 4H7"}),(0,i.Lk)("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"})],-1)]))])]),(0,i.Lk)("div",Bt,[(0,i.Lk)("div",Vt,[t[17]||(t[17]=(0,i.Lk)("h1",{class:"groups-title"},"My Groups",-1)),0===a.myGroups.length?((0,i.uX)(),(0,i.CE)("div",Ht,[t[15]||(t[15]=(0,i.Lk)("p",null,"You haven't joined any groups yet.",-1)),(0,i.Lk)("button",{class:"explore-btn",onClick:t[6]||(t[6]=(...e)=>n.goToForum&&n.goToForum(...e))},"Explore Groups")])):((0,i.uX)(),(0,i.CE)("div",Jt,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.myGroups,(e=>((0,i.uX)(),(0,i.CE)("div",{key:e.id,class:"group-card"},[(0,i.Lk)("div",Wt,[(0,i.Lk)("h3",null,(0,r.v_)(e.title),1),(0,i.Lk)("p",null,(0,r.v_)(e.description),1),(0,i.Lk)("button",{class:"show-invitations-btn",onClick:t=>n.toggleInvitations(e.id)},(0,r.v_)(a.showInvitations[e.id]?"Hide Invitations":"Show Invitations"),9,Kt)]),(0,i.Lk)("div",zt,[(0,i.Lk)("button",{class:"view-btn",onClick:t=>n.viewGroup(e.id)},"View Group",8,Yt),e.is_owner?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("button",{key:0,class:"leave-btn",onClick:t=>n.leaveGroup(e.id)},"Leave Group",8,Zt))]),a.showInvitations[e.id]?((0,i.uX)(),(0,i.CE)("div",eo,[t[16]||(t[16]=(0,i.Lk)("h4",null,"Pending Invitations",-1)),(0,i.Lk)("div",to,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.pendingInvitations,(t=>((0,i.uX)(),(0,i.CE)("div",{key:t.id,class:"invitation-card"},[(0,i.Lk)("div",oo,[(0,i.Lk)("h3",null,(0,r.v_)(t.title),1),(0,i.Lk)("p",null,(0,r.v_)(t.description),1),(0,i.Lk)("p",so,"Invited by: "+(0,r.v_)(t.username),1)]),(0,i.Lk)("div",io,[(0,i.Lk)("button",{class:"accept-btn",onClick:o=>n.handleInvitation(e.id,t.id,"accept")},"Accept",8,ao),(0,i.Lk)("button",{class:"refuse-btn",onClick:o=>n.handleInvitation(e.id,t.id,"refuse")},"Refuse",8,no)])])))),128))])])):(0,i.Q3)("",!0)])))),128))])),(0,i.Lk)("button",{class:"back-btn",onClick:t[7]||(t[7]=(...e)=>n.goBack&&n.goBack(...e))},"Back to Forum")])])])}var co={name:"MyGroups",data(){return{myGroups:[],pendingInvitations:[],showInvitations:{},user:{name:""},showNotifications:!1,notifications:[],unreadNotificationCount:0}},beforeRouteEnter(e,t,o){fetch("https://back-production-bb9b.up.railway.app//api/info",{method:"GET",credentials:"include"}).then((e=>{e.ok?o():o("/login")})).catch((()=>{o("/login")}))},async mounted(){await this.fetchMyGroups(),await this.fetchPendingInvitations(),document.addEventListener("click",this.handleNotifClose),this.fetchNotifications()},async created(){const e=await fetch("https://back-production-bb9b.up.railway.app//api/info",{method:"GET",credentials:"include"}),t=await e.json();console.log("userData",t),this.user.name=t.Username},methods:{async fetchMyGroups(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/mygroups",{credentials:"include"});e.ok&&(this.myGroups=await e.json())}catch(e){console.error("Error fetching groups:",e)}},async fetchPendingInvitations(e){try{const t=await fetch(`https://back-production-bb9b.up.railway.app//api/GetInvitations?group_id=${e}`,{credentials:"include"});t.ok&&(this.pendingInvitations=await t.json())}catch(t){console.error("Error fetching pending invitations:",t)}},async toggleInvitations(e){Object.keys(this.showInvitations).forEach((t=>{t!==e.toString()&&(this.showInvitations[t]=!1)})),this.showInvitations[e]=!this.showInvitations[e],this.showInvitations[e]&&await this.fetchPendingInvitations(e)},goBack(){this.$router.push("/home")},goToForum(){this.$router.push("/home")},goToHome(){this.$router.push("/home")},goToProfile(){this.$router.push(`/profile/${this.user.name}`)},logout(){fetch("https://back-production-bb9b.up.railway.app//api/logout",{method:"POST",credentials:"include"}).then((e=>{e.ok||console.error("Logout failed"),this.$router.push("/login")})).catch((e=>{console.error("Logout error:",e),this.$router.push("/login")}))},viewGroup(e){this.$router.push(`/group/${e}`)},async handleInvitation(e,t,o){try{const s="accept"===o?"https://back-production-bb9b.up.railway.app//api/acceptgroupmember":"https://back-production-bb9b.up.railway.app//api/removememberfromgroup",i=await fetch(s,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({group_id:e,user_id:t})});i.ok?await this.fetchPendingInvitations(e):console.error("Failed to handle invitation:",await i.text())}catch(s){console.error("Error handling invitation:",s)}},async leaveGroup(e){try{const t=await fetch("https://back-production-bb9b.up.railway.app//api/info",{method:"GET",credentials:"include"});if(!t.ok)return void console.error("Failed to get user information");const o=await t.json(),s=await fetch("https://back-production-bb9b.up.railway.app//api/removememberfromgroup",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({group_id:e,user_id:o.id})});if(s.ok)console.log("Successfully left the group"),await this.fetchMyGroups();else{const e=await s.text();console.error("Failed to leave group:",e)}}catch(t){console.error("Error leaving group:",t)}},async handleNotifClick(){this.showNotifications=!this.showNotifications,this.showNotifications&&await this.fetchNotifications()},async fetchNotifications(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/notifications",{method:"GET",credentials:"include"});if(e.ok){const t=await e.json();this.notifications=t,this.unreadNotificationCount=t.filter((e=>!e.is_read)).length}}catch(e){console.error("Failed to fetch notifications:",e)}},async markNotificationAsRead(e){console.log(e);try{const t=this.notifications.find((t=>t.id===e));if(!t)return;setTimeout((async()=>{try{const o=await fetch("https://back-production-bb9b.up.railway.app//api/markasread",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({notificationId:e,is_read:1})});console.log("res",o),o.ok&&(t.is_read=!0)}catch(o){console.error("Error marking notification as read:",o)}}),3e3)}catch(t){console.error("Error marking notification as read:",t)}},formatTimestamp(e){if(!e)return"";const t=new Date(e),o=new Date,s=o-t;return s<6e4?"just now":s<36e5?`${Math.floor(s/6e4)}m ago`:s<864e5?`${Math.floor(s/36e5)}h ago`:s<6048e5?`${Math.floor(s/864e5)}d ago`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},handleNotifClose(e){!this.showNotifications||this.$refs.notifBtn.contains(e.target)||this.$refs.notifPopup.contains(e.target)||(this.showNotifications=!1)}},beforeUnmount(){document.removeEventListener("click",this.handleNotifClose)}};const lo=(0,u.A)(co,[["render",ro],["__scopeId","data-v-5c344626"]]);var uo=lo;const ho={class:"group-layout"},po={class:"notifications-container"},mo={class:"sidebar"},go={class:"sidebar-icons"},ko={key:0,class:"notif-badge"},fo={key:0,ref:"notifPopup",class:"notif-popup"},vo={class:"notif-list"},wo={key:0,class:"notif-item empty"},bo=["onClick"],yo={class:"notif-text"},Lo={key:0},Co={key:1},Eo={class:"notif-time"},_o={class:"group-main-content"},No={class:"group-container"},Po={class:"group-header"},Io={class:"group-info"},Mo={key:0,class:"membership-status not-member"},Fo={key:1,class:"membership-status pending"},To={key:2,class:"membership-status invited"},$o={class:"invitation-actions"},xo={key:3,class:"membership-status accepted"},Xo={key:0},Uo={key:1},So={class:"group-actions"},jo={key:0,class:"badge"},Ao={key:0,class:"group-content"},Go={class:"create-post-section"},Do={class:"file-upload-label"},Oo=["src"],qo={class:"posts-section"},Qo={key:0,class:"no-posts"},Ro={class:"post-header"},Bo=["src"],Vo={class:"post-timestamp"},Ho={class:"post-title"},Jo={class:"post-content"},Wo={key:0,class:"post-image"},Ko=["src"],zo={class:"post-actions"},Yo=["onClick"],Zo={key:1,class:"comments-section"},es={key:0,class:"no-comments"},ts={class:"comment-header"},os=["src"],ss={class:"comment-timestamp"},is={class:"comment-content"},as={key:0,class:"comment-image"},ns=["src"],rs=["onSubmit"],cs=["onUpdate:modelValue"],ls={class:"file-upload-label"},us=["onChange"],ds=["src"],hs={class:"group-chat-section"},ps={class:"chat-messages"},ms={key:0,class:"no-messages"},gs=["src"],ks={class:"message-header"},fs={class:"message-meta"},vs={class:"message-author"},ws={class:"message-time"},bs={class:"message-content"},ys={key:1,class:"non-member-content"},Ls={class:"non-member-message"},Cs={key:0},Es={key:1},_s={key:2},Ns={key:3},Ps={key:2,class:"modal-overlay"},Is={class:"modal-content"},Ms={class:"modal-header"},Fs={class:"create-event-form"},Ts={class:"form-group"},$s={class:"form-group"},xs={class:"form-group"},Xs={class:"form-group"},Us={class:"events-container"},Ss={class:"events-section"},js={key:0,class:"no-events"},As={key:1,class:"event-list"},Gs={class:"event-info"},Ds={class:"event-date"},Os={class:"event-location"},qs={class:"event-description"},Qs={class:"event-response-stats"},Rs={class:"response-stat going"},Bs={class:"response-count"},Vs={class:"response-stat not-going"},Hs={class:"response-count"},Js={class:"event-actions"},Ws=["onClick","disabled"],Ks={class:"btn-icon"},zs=["onClick","disabled"],Ys={class:"btn-icon"},Zs={class:"events-section"},ei={key:0,class:"no-events"},ti={key:1,class:"event-list"},oi={class:"event-info"},si={class:"event-date"},ii={class:"event-location"},ai={class:"event-description"},ni={key:3,class:"modal-overlay"},ri={class:"modal-content"},ci={class:"modal-header"},li={class:"member-requests-container"},ui={key:0,class:"no-requests"},di={key:1,class:"requests-list"},hi={class:"request-info"},pi=["src"],mi={class:"request-details"},gi={class:"request-actions"},ki=["onClick"],fi=["onClick"],vi={key:4,class:"modal-overlay"},wi={class:"modal-content invite-members-modal"},bi={class:"search-box"},yi={class:"users-list"},Li={key:0,class:"no-users"},Ci={key:1,class:"users-list-container"},Ei={class:"user-info"},_i=["src","alt"],Ni={class:"user-name"},Pi=["disabled","onClick"],Ii={class:"modal-buttons"};function Mi(e,t,o,a,n,c){return(0,i.uX)(),(0,i.CE)("div",ho,[(0,i.Lk)("div",po,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.notifications,(e=>((0,i.uX)(),(0,i.CE)("div",{key:e.id,class:(0,r.C4)(["notification",`notification-${e.type}`])},(0,r.v_)(e.message),3)))),128))]),n.notification.visible?((0,i.uX)(),(0,i.CE)("div",{key:0,class:(0,r.C4)(["notification",`notification-${n.notification.type}`])},(0,r.v_)(n.notification.message),3)):(0,i.Q3)("",!0),(0,i.Lk)("aside",mo,[(0,i.Lk)("div",go,[(0,i.Lk)("div",{class:"sidebar-icon",title:"Home",onClick:t[0]||(t[0]=(...e)=>c.goToHome&&c.goToHome(...e))},t[29]||(t[29]=[(0,i.Lk)("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M3 12L12 3l9 9"}),(0,i.Lk)("path",{d:"M9 21V9h6v12"})],-1)])),(0,i.Lk)("div",{class:"sidebar-icon",title:"Profile",onClick:t[1]||(t[1]=(...e)=>c.goToProfile&&c.goToProfile(...e))},t[30]||(t[30]=[(0,i.Lk)("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("circle",{cx:"12",cy:"8",r:"4"}),(0,i.Lk)("path",{d:"M4 21v-2a4 4 0 014-4h8a4 4 0 014 4v2"})],-1)])),(0,i.Lk)("div",{class:"sidebar-icon active",title:"Groups",onClick:t[2]||(t[2]=(...e)=>c.goToMyGroups&&c.goToMyGroups(...e))},t[31]||(t[31]=[(0,i.Fv)('<svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" data-v-aeec6024><path d="M17 21v-2a4 4 0 00-4-4H7a4 4 0 00-4 4v2" data-v-aeec6024></path><circle cx="9" cy="7" r="4" data-v-aeec6024></circle><path d="M23 21v-2a4 4 0 00-3-3.87" data-v-aeec6024></path><path d="M16 3.13a4 4 0 010 7.75" data-v-aeec6024></path></svg>',1)])),(0,i.Lk)("div",{class:"sidebar-icon",title:"Settings",onClick:t[3]||(t[3]=t=>e.$router.push("/settings"))},t[32]||(t[32]=[(0,i.Lk)("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("circle",{cx:"12",cy:"12",r:"3"}),(0,i.Lk)("path",{d:"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09a1.65 1.65 0 00-1-1.51 1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09a1.65 1.65 0 001.51-1 1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06a1.65 1.65 0 001.82.33h.09A1.65 1.65 0 008.91 3H9a2 2 0 014 0v.09a1.65 1.65 0 001 1.51h.09a1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06a1.65 1.65 0 00-.33 1.82v.09a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"})],-1)])),(0,i.Lk)("div",{class:"sidebar-icon",ref:"notifBtn",title:"Notifications",onClick:t[4]||(t[4]=(...e)=>c.handleNotifClick&&c.handleNotifClick(...e))},[t[33]||(t[33]=(0,i.Lk)("svg",{width:"22",height:"22",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M18 8a6 6 0 10-12 0c0 7-3 9-3 9h18s-3-2-3-9"}),(0,i.Lk)("path",{d:"M13.73 21a2 2 0 01-3.46 0"})],-1)),c.unreadNotificationCount>0?((0,i.uX)(),(0,i.CE)("span",ko,(0,r.v_)(c.unreadNotificationCount),1)):(0,i.Q3)("",!0)],512),n.showNotifications?((0,i.uX)(),(0,i.CE)("div",fo,[t[34]||(t[34]=(0,i.Lk)("div",{class:"notif-popup-header"},"Notifications",-1)),(0,i.Lk)("ul",vo,[n.notifications&&0!==n.notifications.length?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("li",wo," No notifications yet. ")),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.notifications||[],(e=>((0,i.uX)(),(0,i.CE)("li",{key:e.time+e.sender,class:(0,r.C4)(["notif-item",{unread:!e.is_read}]),onClick:t=>c.markNotificationAsRead(e.id)},[(0,i.Lk)("span",yo,[(0,i.Lk)("b",null,(0,r.v_)(e.sender),1),"message"===e.type?((0,i.uX)(),(0,i.CE)("span",Lo,"sent you a message: "+(0,r.v_)(e.text&&e.text.length>40?e.text.slice(0,40)+"…":e.text),1)):((0,i.uX)(),(0,i.CE)("span",Co,(0,r.v_)(e.text),1))]),(0,i.Lk)("span",Eo,(0,r.v_)(c.formatTimestamp(e.time)),1)],10,bo)))),128))])],512)):(0,i.Q3)("",!0),(0,i.Lk)("div",{class:"sidebar-icon",title:"Logout",onClick:t[5]||(t[5]=(...e)=>c.logout&&c.logout(...e))},t[35]||(t[35]=[(0,i.Lk)("svg",{width:"22",height:"22",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M17 16l4-4m0 0l-4-4m4 4H7"}),(0,i.Lk)("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"})],-1)]))])]),(0,i.Lk)("div",_o,[(0,i.Lk)("div",No,[(0,i.Lk)("header",Po,[(0,i.Lk)("div",Io,[(0,i.Lk)("h2",null,(0,r.v_)(n.group.title),1),(0,i.Lk)("p",null,(0,r.v_)(n.group.description),1),n.isMember||"pending"===n.membershipStatus||"invited"===n.membershipStatus?"pending"===n.membershipStatus?((0,i.uX)(),(0,i.CE)("div",Fo," Your membership is pending approval ")):"invited"===n.membershipStatus?((0,i.uX)(),(0,i.CE)("div",To,[t[36]||(t[36]=(0,i.eW)(" You have been invited to this group ")),(0,i.Lk)("div",$o,[(0,i.Lk)("button",{class:"accept-btn",onClick:t[6]||(t[6]=e=>c.handleInvitation("accept"))}," Accept Invitation "),(0,i.Lk)("button",{class:"decline-btn",onClick:t[7]||(t[7]=e=>c.handleInvitation("decline"))}," Decline Invitation ")])])):((0,i.uX)(),(0,i.CE)("div",xo,[n.group.is_owner?((0,i.uX)(),(0,i.CE)("span",Xo,"You are the owner of this group")):((0,i.uX)(),(0,i.CE)("span",Uo,"You are a member of this group"))])):((0,i.uX)(),(0,i.CE)("div",Mo," You are not a member of this group "))]),(0,i.Lk)("div",So,[(0,i.Lk)("button",{class:"back-btn",onClick:t[8]||(t[8]=(...e)=>c.goBack&&c.goBack(...e))},"Back to Forum"),n.group.is_owner?((0,i.uX)(),(0,i.CE)("button",{key:0,class:"member-requests-btn",onClick:t[9]||(t[9]=e=>n.showMemberRequestsModal=!0)},[t[37]||(t[37]=(0,i.eW)(" Member Requests ")),n.pendingRequests.length>0?((0,i.uX)(),(0,i.CE)("span",jo,(0,r.v_)(n.pendingRequests.length),1)):(0,i.Q3)("",!0)])):(0,i.Q3)("",!0),"accepted"===n.membershipStatus?((0,i.uX)(),(0,i.CE)("button",{key:1,class:"invite-btn",onClick:t[10]||(t[10]=(...e)=>c.openInviteModal&&c.openInviteModal(...e))}," Invite Members ")):(0,i.Q3)("",!0),"accepted"===n.membershipStatus?((0,i.uX)(),(0,i.CE)("button",{key:2,class:"event-btn",onClick:t[11]||(t[11]=e=>n.showEventModal=!0)}," Create Event ")):(0,i.Q3)("",!0),n.group.is_owner||"accepted"!==n.membershipStatus?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("button",{key:3,class:"leave-btn",onClick:t[12]||(t[12]=(...e)=>c.leaveGroup&&c.leaveGroup(...e))}," Leave Group "))])]),"accepted"===n.membershipStatus?((0,i.uX)(),(0,i.CE)("div",Ao,[(0,i.Lk)("div",Go,[t[41]||(t[41]=(0,i.Lk)("h3",null,"Create a Post",-1)),(0,i.Lk)("form",{onSubmit:t[16]||(t[16]=(0,s.D$)(((...e)=>c.createPost&&c.createPost(...e)),["prevent"]))},[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[13]||(t[13]=e=>n.newPost.title=e),type:"text",placeholder:"Post title",required:""},null,512),[[s.Jo,n.newPost.title]]),(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":t[14]||(t[14]=e=>n.newPost.content=e),placeholder:"What's on your mind?",required:""},null,512),[[s.Jo,n.newPost.content]]),(0,i.Lk)("label",Do,[t[38]||(t[38]=(0,i.Lk)("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),(0,i.Lk)("polyline",{points:"17 8 12 3 7 8"}),(0,i.Lk)("line",{x1:"12",y1:"3",x2:"12",y2:"15"})],-1)),t[39]||(t[39]=(0,i.eW)(" Upload Image ")),(0,i.Lk)("input",{type:"file",accept:"image/*",onChange:t[15]||(t[15]=(...e)=>c.handleImageUpload&&c.handleImageUpload(...e))},null,32)]),n.image?((0,i.uX)(),(0,i.CE)("img",{key:0,src:n.image,class:"image-preview",alt:"Preview"},null,8,Oo)):(0,i.Q3)("",!0),t[40]||(t[40]=(0,i.Lk)("button",{type:"submit"},"Post",-1))],32)]),(0,i.Lk)("div",qo,[t[44]||(t[44]=(0,i.Lk)("h3",null,"Group Posts",-1)),0===n.posts.length?((0,i.uX)(),(0,i.CE)("div",Qo," No posts yet. Be the first to post! ")):((0,i.uX)(!0),(0,i.CE)(i.FK,{key:1},(0,i.pI)(n.posts,(e=>((0,i.uX)(),(0,i.CE)("div",{class:"post-card",key:e.id},[(0,i.Lk)("div",Ro,[(0,i.Lk)("img",{src:e.authorAvatar,alt:"Author",class:"post-author-pic"},null,8,Bo),(0,i.Lk)("div",null,[(0,i.Lk)("h4",null,(0,r.v_)(e.author),1),(0,i.Lk)("p",Vo,(0,r.v_)(c.formatTimestamp(e.created_at)),1)])]),(0,i.Lk)("h3",Ho,(0,r.v_)(e.title),1),(0,i.Lk)("p",Jo,(0,r.v_)(e.content),1),e.image?((0,i.uX)(),(0,i.CE)("div",Wo,[(0,i.Lk)("img",{src:e.image,alt:"Post Image",id:"groupostimage"},null,8,Ko)])):(0,i.Q3)("",!0),(0,i.Lk)("div",zo,[(0,i.Lk)("button",{onClick:t=>c.toggleComments(e)},(0,r.v_)(e.showComments?"Hide Comments":"Show Comments"),9,Yo)]),e.showComments?((0,i.uX)(),(0,i.CE)("div",Zo,[0===e.comments.length?((0,i.uX)(),(0,i.CE)("div",es," No comments yet ")):((0,i.uX)(!0),(0,i.CE)(i.FK,{key:1},(0,i.pI)(e.comments,(e=>((0,i.uX)(),(0,i.CE)("div",{class:"comment",key:e.id},[(0,i.Lk)("div",ts,[(0,i.Lk)("img",{src:e.authorAvatar,alt:"Comment Author",class:"comment-author-pic"},null,8,os),(0,i.Lk)("div",null,[(0,i.Lk)("h5",null,(0,r.v_)(e.author),1),(0,i.Lk)("p",ss,(0,r.v_)(c.formatTimestamp(e.created_at)),1)])]),(0,i.Lk)("p",is,(0,r.v_)(e.content),1),e.image?((0,i.uX)(),(0,i.CE)("div",as,[(0,i.Lk)("img",{src:`${n.apiUrl}/uploads/${e.image}`,alt:"Comment Image",style:{"max-width":"200px","max-height":"200px","margin-top":"8px"}},null,8,ns)])):(0,i.Q3)("",!0)])))),128)),(0,i.Lk)("form",{onSubmit:(0,s.D$)((t=>c.addComment(e)),["prevent"]),class:"comment-form",enctype:"multipart/form-data"},[(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":t=>e.newComment=t,placeholder:"Add a comment...",required:""},null,8,cs),[[s.Jo,e.newComment]]),(0,i.Lk)("label",ls,[t[42]||(t[42]=(0,i.Lk)("svg",{width:"18",height:"18",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),(0,i.Lk)("polyline",{points:"17 8 12 3 7 8"}),(0,i.Lk)("line",{x1:"12",y1:"3",x2:"12",y2:"15"})],-1)),(0,i.Lk)("input",{type:"file",accept:"image/*",onChange:t=>c.onCommentImageChange(t,e)},null,40,us)]),e.commentImagePreview?((0,i.uX)(),(0,i.CE)("img",{key:0,src:e.commentImagePreview,class:"image-preview",alt:"Preview"},null,8,ds)):(0,i.Q3)("",!0),t[43]||(t[43]=(0,i.Lk)("button",{type:"submit"},"Comment",-1))],40,rs)])):(0,i.Q3)("",!0)])))),128))]),(0,i.Lk)("div",hs,[t[46]||(t[46]=(0,i.Lk)("h3",null,"Group Chat",-1)),(0,i.Lk)("div",ps,[0===n.chatMessages.length?((0,i.uX)(),(0,i.CE)("div",ms," No messages yet ")):((0,i.uX)(!0),(0,i.CE)(i.FK,{key:1},(0,i.pI)(n.chatMessages,(e=>((0,i.uX)(),(0,i.CE)("div",{class:"message",key:e.id},[(0,i.Lk)("img",{src:e.authorAvatar,alt:"Author",class:"message-author-pic"},null,8,gs),(0,i.Lk)("div",ks,[(0,i.Lk)("div",fs,[(0,i.Lk)("span",vs,(0,r.v_)(e.username),1),(0,i.Lk)("span",ws,(0,r.v_)(c.formatMessageTime(e.created_at)),1)]),(0,i.Lk)("p",bs,(0,r.v_)(e.content),1)])])))),128))]),(0,i.Lk)("form",{onSubmit:t[18]||(t[18]=(0,s.D$)(((...e)=>c.sendMessage&&c.sendMessage(...e)),["prevent"])),class:"chat-input"},[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[17]||(t[17]=e=>n.newMessage=e),type:"text",placeholder:"Type a message...",required:""},null,512),[[s.Jo,n.newMessage]]),t[45]||(t[45]=(0,i.Lk)("button",{type:"submit"},"Send",-1))],32)])])):((0,i.uX)(),(0,i.CE)("div",ys,[(0,i.Lk)("div",Ls,["pending"===n.membershipStatus?((0,i.uX)(),(0,i.CE)("h3",Cs,"Your membership request is pending approval")):((0,i.uX)(),(0,i.CE)("h3",Es,"Join this group to see its content")),"pending"===n.membershipStatus?((0,i.uX)(),(0,i.CE)("p",_s,"Please wait for an admin to approve your request.")):((0,i.uX)(),(0,i.CE)("p",Ns,"This is a private group. You need to be a member to see posts, events, and participate in discussions."))])])),n.showEventModal?((0,i.uX)(),(0,i.CE)("div",Ps,[(0,i.Lk)("div",Is,[(0,i.Lk)("div",Ms,[t[47]||(t[47]=(0,i.Lk)("h3",null,"Group Events",-1)),(0,i.Lk)("button",{class:"close-btn",onClick:t[19]||(t[19]=e=>n.showEventModal=!1)}," × ")]),(0,i.Lk)("div",Fs,[t[53]||(t[53]=(0,i.Lk)("h4",null,"Create New Event",-1)),(0,i.Lk)("form",{onSubmit:t[24]||(t[24]=(0,s.D$)(((...e)=>c.createEvent&&c.createEvent(...e)),["prevent"]))},[(0,i.Lk)("div",Ts,[t[48]||(t[48]=(0,i.Lk)("label",null,"Event Title",-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[20]||(t[20]=e=>n.newEvent.title=e),type:"text",required:"",placeholder:"Enter event title"},null,512),[[s.Jo,n.newEvent.title]])]),(0,i.Lk)("div",$s,[t[49]||(t[49]=(0,i.Lk)("label",null,"Date and Time",-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[21]||(t[21]=e=>n.newEvent.date=e),type:"datetime-local",required:""},null,512),[[s.Jo,n.newEvent.date]])]),(0,i.Lk)("div",xs,[t[50]||(t[50]=(0,i.Lk)("label",null,"Description",-1)),(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":t[22]||(t[22]=e=>n.newEvent.description=e),required:"",placeholder:"Enter event description"},null,512),[[s.Jo,n.newEvent.description]])]),(0,i.Lk)("div",Xs,[t[51]||(t[51]=(0,i.Lk)("label",null,"Location",-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[23]||(t[23]=e=>n.newEvent.location=e),type:"text",required:"",placeholder:"Enter event location"},null,512),[[s.Jo,n.newEvent.location]])]),t[52]||(t[52]=(0,i.Lk)("button",{type:"submit",class:"submit-btn"},"Create Event",-1))],32)]),(0,i.Lk)("div",Us,[(0,i.Lk)("div",Ss,[t[58]||(t[58]=(0,i.Lk)("h4",null,"Upcoming Events",-1)),0===n.upcomingEvents.length?((0,i.uX)(),(0,i.CE)("div",js," No upcoming events ")):((0,i.uX)(),(0,i.CE)("div",As,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.upcomingEvents,(e=>((0,i.uX)(),(0,i.CE)("div",{key:e.id,class:"event-item"},[(0,i.Lk)("div",Gs,[(0,i.Lk)("h5",null,(0,r.v_)(e.title),1),(0,i.Lk)("p",Ds,"📅 "+(0,r.v_)(c.formatDate(e.date)),1),(0,i.Lk)("p",Os,"📍 "+(0,r.v_)(e.location),1),(0,i.Lk)("p",qs,(0,r.v_)(e.description),1),(0,i.Lk)("div",Qs,[(0,i.Lk)("span",Rs,[t[54]||(t[54]=(0,i.Lk)("span",{class:"response-icon"},"👥",-1)),(0,i.Lk)("span",Bs,(0,r.v_)(e.going_count||0),1),t[55]||(t[55]=(0,i.Lk)("span",{class:"response-label"},"Going",-1))]),(0,i.Lk)("span",Vs,[t[56]||(t[56]=(0,i.Lk)("span",{class:"response-icon"},"✕",-1)),(0,i.Lk)("span",Hs,(0,r.v_)(e.not_going_count||0),1),t[57]||(t[57]=(0,i.Lk)("span",{class:"response-label"},"Not Going",-1))])])]),(0,i.Lk)("div",Js,[n.isMember?((0,i.uX)(),(0,i.CE)("button",{key:0,onClick:t=>c.respondToEvent(e.id,1),class:(0,r.C4)({"response-btn":!0,going:1===e.user_response,active:1===e.user_response}),disabled:1===e.user_response},[(0,i.Lk)("span",Ks,(0,r.v_)(1===e.user_response?"✓":"👤"),1),(0,i.eW)(" "+(0,r.v_)(1===e.user_response?"You're Going":"Going"),1)],10,Ws)):(0,i.Q3)("",!0),n.isMember?((0,i.uX)(),(0,i.CE)("button",{key:1,onClick:t=>c.respondToEvent(e.id,-1),class:(0,r.C4)({"response-btn":!0,"not-going":-1===e.user_response,active:-1===e.user_response}),disabled:-1===e.user_response},[(0,i.Lk)("span",Ys,(0,r.v_)(-1===e.user_response?"✓":"✕"),1),(0,i.eW)(" "+(0,r.v_)((e.user_response,"Not Going")),1)],10,zs)):(0,i.Q3)("",!0)])])))),128))]))]),(0,i.Lk)("div",Zs,[t[59]||(t[59]=(0,i.Lk)("h4",null,"Past Events",-1)),0===n.pastEvents.length?((0,i.uX)(),(0,i.CE)("div",ei," No past events ")):((0,i.uX)(),(0,i.CE)("div",ti,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.pastEvents,(e=>((0,i.uX)(),(0,i.CE)("div",{key:e.id,class:"event-item past"},[(0,i.Lk)("div",oi,[(0,i.Lk)("h5",null,(0,r.v_)(e.title),1),(0,i.Lk)("p",si,"📅 "+(0,r.v_)(c.formatDate(e.date)),1),(0,i.Lk)("p",ii,"📍 "+(0,r.v_)(e.location),1),(0,i.Lk)("p",ai,(0,r.v_)(e.description),1)])])))),128))]))])])])])):(0,i.Q3)("",!0),n.showMemberRequestsModal?((0,i.uX)(),(0,i.CE)("div",ni,[(0,i.Lk)("div",ri,[(0,i.Lk)("div",ci,[t[60]||(t[60]=(0,i.Lk)("h3",null,"Member Requests",-1)),(0,i.Lk)("button",{class:"close-btn",onClick:t[25]||(t[25]=e=>n.showMemberRequestsModal=!1)}," × ")]),(0,i.Lk)("div",li,[0===n.pendingRequests.length?((0,i.uX)(),(0,i.CE)("div",ui," No pending member requests ")):((0,i.uX)(),(0,i.CE)("div",di,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.pendingRequests,(e=>((0,i.uX)(),(0,i.CE)("div",{key:e.id,class:"request-item"},[(0,i.Lk)("div",hi,[(0,i.Lk)("img",{src:`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.username}`,alt:"User Avatar",class:"request-avatar"},null,8,pi),(0,i.Lk)("div",mi,[(0,i.Lk)("h4",null,(0,r.v_)(e.full_name),1),(0,i.Lk)("p",null,(0,r.v_)(e.email),1)])]),(0,i.Lk)("div",gi,[(0,i.Lk)("button",{class:"accept-btn",onClick:t=>c.handleMemberRequest(e.id,"accept")}," Accept ",8,ki),(0,i.Lk)("button",{class:"decline-btn",onClick:t=>c.handleMemberRequest(e.id,"decline")}," Decline ",8,fi)])])))),128))]))])])])):(0,i.Q3)("",!0),n.showInviteMembersModal?((0,i.uX)(),(0,i.CE)("div",vi,[(0,i.Lk)("div",wi,[t[61]||(t[61]=(0,i.Lk)("h3",null,"Invite Members",-1)),(0,i.Lk)("div",bi,[(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[26]||(t[26]=e=>n.searchQuery=e),placeholder:"Search users...",onInput:t[27]||(t[27]=(...e)=>c.searchUsers&&c.searchUsers(...e))},null,544),[[s.Jo,n.searchQuery]])]),(0,i.Lk)("div",yi,[n.filteredUsers&&0!==n.filteredUsers.length?((0,i.uX)(),(0,i.CE)("div",Ci,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.filteredUsers,(e=>((0,i.uX)(),(0,i.CE)("div",{key:e.id,class:"user-item"},[(0,i.Lk)("div",Ei,[(0,i.Lk)("img",{src:e.avatar,alt:e.username,class:"user-avatar"},null,8,_i),(0,i.Lk)("span",Ni,(0,r.v_)(e.fullname),1)]),(0,i.Lk)("button",{class:"invite-user-btn",disabled:"invited"===e.status||"pending"===e.status||"accepted"===e.status,onClick:t=>c.inviteUser(e)},(0,r.v_)("invited"===e.status?"Invited":"pending"===e.status?"Request Pending":"accepted"===e.status?"Member":"Invite"),9,Pi)])))),128))])):((0,i.uX)(),(0,i.CE)("div",Li,(0,r.v_)(n.searchQuery?"No users found matching your search":"No users available to invite"),1))]),(0,i.Lk)("div",Ii,[(0,i.Lk)("button",{class:"close-btn",onClick:t[28]||(t[28]=e=>n.showInviteMembersModal=!1)},"Close")])])])):(0,i.Q3)("",!0)])])])}o(7642),o(8004),o(3853),o(5876),o(2475),o(5024),o(1698);var Fi={props:["showNotifications"],name:"GroupPage",data(){return{isLoading:!0,user:{id:"",username:""},group:{id:null,title:"",description:"",is_owner:!1},isMember:!1,isAdmin:!1,membershipStatus:"not_member",posts:[],chatMessages:[],newPost:{title:"",content:"",image:""},newMessage:"",socket:null,showEventModal:!1,showMemberRequestsModal:!1,pendingRequests:[],newEvent:{title:"",date:"",description:"",location:""},upcomingEvents:[],pastEvents:[],notification:{visible:!1,message:"",type:"success"},image:"",notifications:[],showInviteMembersModal:!1,searchQuery:"",filteredUsers:[],allUsers:[],invitedUsers:new Set,groupMembers:[],showNotifications:!1,apiUrl:(void 0).VITE_API_URL}},beforeRouteEnter(e,t,o){fetch("https://back-production-bb9b.up.railway.app//api/info",{method:"GET",credentials:"include"}).then((e=>{e.ok?o():o("/login")})).catch((()=>{o("/login")}))},async created(){console.log("GroupPage component created");const e=this.$route.params.id;console.log("Group ID:",e),await this.checkMembership(e),await this.fetchGroupDetails(e),await this.fetchEvents(this.$route.params.id),await this.fetchPosts(e),await this.fetchNotifications(),this.group.is_owner&&await this.fetchPendingRequests(),this.initializeWebSocket(e)},methods:{async fetchGroupDetails(e){try{const t=await fetch(`https://back-production-bb9b.up.railway.app//api/getgroups?id=${e}`,{method:"GET",credentials:"include"});if(t.ok){const o=await t.json();for(const t of o)if(t.id===e){this.group=t;break}}}catch(t){console.error("Error fetching group details:",t)}},handleNotifClick(){this.showNotifications=!this.showNotifications,this.showNotifications&&this.notifications.forEach((e=>{e.is_read||this.markNotificationAsRead(e.id)}))},handleNotifClose(e){if(!this.showNotifications)return;const t=this.$refs.notifPopup,o=this.$refs.notifBtn;t&&o&&(t.contains(e.target)||o.contains(e.target))||(this.showNotifications=!1)},async fetchNotifications(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/notifications",{method:"GET",credentials:"include"});if(e.ok){const t=await e.json();console.log("sassasaassa",t),this.notifications=Array.isArray(t)?t.map((e=>({id:e.id,sender:e.sender_username||"Unknown",text:e.content||"",time:e.time||(new Date).toISOString(),type:e.type||"notification",is_read:e.is_read||!1}))):[]}else this.notifications=[]}catch(e){console.error("Error fetching notifications:",e),this.notifications=[]}},async markNotificationAsRead(e){try{const t=this.notifications.find((t=>t.id===e));if(!t)return;setTimeout((async()=>{try{const o=await fetch("https://back-production-bb9b.up.railway.app//api/markasread",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({notificationId:e,is_read:1})});o.ok&&(t.is_read=!0)}catch(o){console.error("Error marking notification as read:",o)}}),3e3)}catch(t){console.error("Error marking notification as read:",t)}},async checkMembership(e){try{const t=await fetch(`https://back-production-bb9b.up.railway.app//api/checkmem?group_id=${e}`,{method:"GET",credentials:"include"});if(t.ok){const e=await t.json();console.log("Membership data:",e),this.isMember=e.is_member,this.membershipStatus=e.status||"not_member",this.isAdmin=e.is_admin||!1,this.group.is_owner=e.is_owner||!1,this.isMember&&"pending"!==this.membershipStatus||this.disableFeatures()}}catch(t){console.error("Error checking membership:",t)}},initializeWebSocket(e){this.socket=new WebSocket(`ws://${(void 0).VITE_API_URL.replace("http://","")}/ws/group/${e}`),this.socket.onopen=()=>{console.log("WebSocket connected to group chat")},this.socket.onmessage=e=>{try{const t=JSON.parse(e.data);if(Array.isArray(t))return void(this.chatMessages=t.map((e=>({...e,authorAvatar:e.avatar?`https://back-production-bb9b.up.railway.app//uploads/${e.avatar}`:`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.username}`,created_at:new Date(e.created_at)}))).sort(((e,t)=>e.created_at-t.created_at)));if(t&&t.error)return console.error("WebSocket error:",t.error),void this.showNotification(t.error,"error");t&&t.username&&t.content&&(this.chatMessages.push({...t,authorAvatar:t.avatar?`https://back-production-bb9b.up.railway.app//uploads/${t.avatar}`:`https://api.dicebear.com/7.x/avataaars/svg?seed=${t.username}`,created_at:new Date(t.created_at)}),this.chatMessages.sort(((e,t)=>e.created_at-t.created_at)),this.$nextTick((()=>{const e=document.querySelector(".chat-messages");e&&(e.scrollTop=e.scrollHeight)})))}catch(t){console.error("Error processing WebSocket message:",t),this.showNotification("Error processing message","error")}},this.socket.onerror=e=>{console.error("WebSocket error:",e),this.showNotification("Error connecting to group chat","error")},this.socket.onclose=()=>{console.log("WebSocket disconnected from group chat")}},async sendMessage(){if(this.socket&&this.socket.readyState===WebSocket.OPEN&&this.newMessage.trim())try{this.socket.send(JSON.stringify({content:this.newMessage.trim(),group_id:this.group.id})),this.newMessage=""}catch(e){console.error("Error sending message:",e),this.showNotification("Failed to send message","error")}else this.showNotification("Cannot send message - chat disconnected","error")},handleImageUpload(e){const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{this.image=e.target.result},e.readAsDataURL(t)}},async leaveGroup(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/info",{method:"GET",credentials:"include"});if(!e.ok)return void this.showNotification("Failed to get user information","error");const t=await e.json(),o=await fetch("https://back-production-bb9b.up.railway.app//api/removememberfromgroup",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({group_id:this.group.id,user_id:t.id})});if(o.ok)this.showNotification("Successfully left the group","success"),this.$router.push("/home");else{const e=await o.text();console.error("Failed to leave group:",e),this.showNotification("Failed to leave group","error")}}catch(e){console.error("Error leaving group:",e),this.showNotification("Error leaving group","error")}},goBack(){this.$router.push("/home")},formatTimestamp(e){return new Date(e).toLocaleString()},validateEventDate(e){const t=new Date(e),o=new Date,s=new Date;return s.setFullYear(o.getFullYear()+2),t<o?{valid:!1,message:"Event date cannot be in the past"}:t>s?{valid:!1,message:"Event date cannot be more than 2 years in the future"}:{valid:!0}},async createEvent(){try{const e=this.validateEventDate(this.newEvent.date);if(!e.valid)return void this.showNotification(e.message,"error");const t=await fetch(`https://back-production-bb9b.up.railway.app//api/events/add?group_id=${this.$route.params.id}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({group_id:this.group.id,...this.newEvent})});if(!t.ok)throw new Error("Failed to create event");this.showNotification("Event created successfully!","success"),this.newEvent={title:"",date:"",description:"",location:""},await this.fetchEvents(this.$route.params.id),this.showEventModal=!1}catch(e){console.error("Error creating event:",e),this.showNotification("Failed to create event","error")}},async respondToEvent(e,t){try{const o=await fetch(`https://back-production-bb9b.up.railway.app//api/events/join?event_id=${e}&response=${t}`,{method:"POST",credentials:"include"});if(!o.ok)throw new Error("Failed to update response");const s=await o.json(),i=this.upcomingEvents.find((t=>t.id===e));i&&(i.going_count=s.going_count,i.not_going_count=s.not_going_count,i.user_response=t);const a=1===t?"You're going to the event!":"You've marked as not going";this.showNotification(a,"success")}catch(o){console.error("Error responding to event:",o),this.showNotification("Failed to update response","error")}},showNotification(e,t="success"){this.notification={visible:!0,message:e,type:t},setTimeout((()=>{this.notification.visible=!1}),3e3)},async fetchEvents(e){try{const t=await fetch(`https://back-production-bb9b.up.railway.app//api/events?id=${e}`,{credentials:"include"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const o=await t.json(),s=new Date;if(o){const e=o.map((e=>({...e,date:e.date||e.event_datetime||e.eventDateTime,going_count:e.going_count||0,not_going_count:e.not_going_count||0,user_response:e.response||null})));this.upcomingEvents=e.filter((e=>new Date(e.date)>s)).sort(((e,t)=>new Date(e.date)-new Date(t.date))),this.pastEvents=e.filter((e=>new Date(e.date)<=s)).sort(((e,t)=>new Date(t.date)-new Date(e.date))),console.log("Fetched events with response counts:",this.upcomingEvents)}}catch(t){console.error("Error fetching events:",t),this.showNotification("Error fetching events","error"),this.upcomingEvents=[],this.pastEvents=[]}},async fetchPosts(e){try{const t=await fetch(`https://back-production-bb9b.up.railway.app//api/groupposts?group_id=${e}`,{credentials:"include"});if(t.ok){const e=await t.json();e&&(this.posts=e.map((e=>({...e,id:e.id,author:e.author,authorAvatar:e.Avatar?e.Avatar:`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.author}`,image:e.image?e.image:null,created_at:e.creation_date,comments:[],showComments:!1,newComment:"",commentError:"",commentImage:null}))))}else console.error("Failed to fetch posts"),this.showNotification("Failed to fetch posts","error")}catch(t){console.error("Error fetching posts:",t),this.showNotification("Error fetching posts","error")}},async createPost(){const e=this.$route.params.id;try{const t=await fetch(`https://back-production-bb9b.up.railway.app//api/groupposts/add?group_id=${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:this.newPost.title,content:this.newPost.content,image:this.image})});if(t.ok){this.newPost={title:"",content:"",image:""},this.image="";const t=document.querySelector('input[type="file"]');t&&(t.value=""),await this.fetchPosts(e)}else{const e=await t.text();console.error("Post failed:",e)}}catch(t){console.error("Error creating post:",t)}},handleImageUpload(e){const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{this.image=e.target.result},e.readAsDataURL(t)}},async addComment(e){if(!e.newComment.trim()&&!e.commentImage)return void(e.commentError="Comment cannot be empty.");const t=new FormData;t.append("group_post_id",e.id),t.append("content",e.newComment.trim()),e.commentImage&&t.append("image",e.commentImage);try{const o=await fetch("https://back-production-bb9b.up.railway.app//api/groupcomments/add",{method:"POST",credentials:"include",body:t});if(o.ok){e.commentError="",e.newComment="",e.commentImage=null,e.commentImagePreview=null;const t=document.querySelector(`input[type="file"][data-post-id="${e.id}"]`);t&&(t.value=""),this.showNotification("Comment added successfully","success"),await this.fetchComments(e)}else e.commentError="Failed to add comment.",this.showNotification("Failed to add comment","error")}catch(o){e.commentError="Error adding comment.",this.showNotification("Error adding comment","error")}},onCommentImageChange(e,t){const o=e.target.files[0];o?(t.commentImage=o,t.commentImagePreview=URL.createObjectURL(o)):(t.commentImage=null,t.commentImagePreview=null)},async fetchComments(e){try{const t=await fetch(`https://back-production-bb9b.up.railway.app//api/groupcomments?group_post_id=${e.id}`,{method:"GET",credentials:"include"});if(t.ok){const o=await t.json();e.comments=o.map((e=>({...e,authorAvatar:e.avatar?`https://back-production-bb9b.up.railway.app//uploads/${e.avatar}`:`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.author}`,created_at:e.creation_date,image:e.image})))}else e.commentError="Failed to load comments."}catch(t){e.commentError="Error loading comments."}},toggleComments(e){console.log(e),e.showComments=!e.showComments,e.showComments&&0===e.comments.length&&this.fetchComments(e)},formatDate(e){return new Date(e).toLocaleString()},goToHome(){this.$router.push("/home")},goToProfile(){this.$router.push(`/profile/${this.user.username}`)},goToMyGroups(){this.$router.push("/mygroups")},logout(){fetch("https://back-production-bb9b.up.railway.app//api/logout",{method:"POST",credentials:"include"}).then((e=>{e.ok,this.$router.push("/login")})).catch((()=>{this.$router.push("/login")}))},disableFeatures(){this.posts=[],this.chatMessages=[],this.upcomingEvents=[],this.pastEvents=[]},async fetchPendingRequests(){if(this.group.id)try{const e=await fetch(`https://back-production-bb9b.up.railway.app//api/GetInvitations?group_id=${this.group.id}`,{credentials:"include"});if(e.ok){const t=await e.json();console.log("Pending requests data:",t),this.pendingRequests=Array.isArray(t)?t:[]}}catch(e){console.error("Error fetching pending requests:",e),this.pendingRequests=[]}},async handleMemberRequest(e,t){try{const o="accept"===t?"https://back-production-bb9b.up.railway.app//api/acceptgroupmember":"https://back-production-bb9b.up.railway.app//api/removememberfromgroup",s=await fetch(o,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({group_id:this.group.id,user_id:e})});if(!s.ok)throw new Error("Failed to handle member request");await this.fetchPendingRequests(),this.showNotification(`Member request ${"accept"===t?"accepted":"declined"} successfully`,"success")}catch(o){console.error("Error handling member request:",o),this.showNotification(`Failed to ${t} member request`,"error")}},async handleInvitation(e){try{const t="accept"===e?"https://back-production-bb9b.up.railway.app//api/acceptgroupinvite":"https://back-production-bb9b.up.railway.app//api/declinegroupinvite";await fetch(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({group_id:this.group.id,action:e})});console.log(`Invitation ${e} request sent for group ID: ${this.group.id}`),"accept"===e?(this.membershipStatus="accepted",this.isMember=!0,this.showNotification("Successfully joined the group","success")):(this.membershipStatus=null,this.isMember=!1,this.showNotification("Successfully declined the invitation","success")),await this.fetchGroupDetails(this.group.id),await this.fetchPosts(this.group.id),await this.fetchEvents(this.group.id),await this.fetchPendingRequests()}catch(t){console.error(`Error ${e}ing invitation:`,t),this.showNotification(`Failed to ${e} invitation. Please try again.`,"error")}},async fetchAllUsers(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/allusers",{credentials:"include"});if(e.ok){const t=await e.json();console.log("Fetched users:",t),this.allUsers=t.map((e=>({fullname:e.fullname,id:e.id,username:e.username,avatar:e.avatar?`https://back-production-bb9b.up.railway.app//uploads/${e.avatar}`:`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.username}`,invited:!1}))),console.log("Processed users:",this.allUsers),this.filteredUsers=[...this.allUsers]}}catch(e){console.error("Error fetching users:",e),this.showNotification("Failed to fetch users","error")}},async searchUsers(){console.log("Search query:",this.searchQuery),console.log("All users:",this.allUsers);try{const e=await fetch(`https://back-production-bb9b.up.railway.app//api/groupmembers/status?group_id=${this.group.id}`,{credentials:"include"});if(e.ok){const t=await e.json();console.log("Member statuses:",t),this.allUsers=this.allUsers.map((e=>({...e,status:t[e.id]||null})))}}catch(e){console.error("Error fetching member statuses:",e)}if(this.searchQuery.trim()){const e=this.searchQuery.toLowerCase();this.filteredUsers=this.allUsers.filter((t=>t.username.toLowerCase().includes(e)))}else this.filteredUsers=[...this.allUsers];console.log("Filtered users:",this.filteredUsers)},async inviteUser(e){try{const o=await fetch("https://back-production-bb9b.up.railway.app//api/addmembertogroup",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({group_id:this.group.id,user_id:e.id,status:"invited"})});if(console.log("Invitation sent to:",e.id,this.group.id,"status:","invited"),o.ok){e.status="invited",this.invitedUsers.add(e.id),this.showNotification(`Invitation sent to ${e.username}`,"success");try{await fetch("https://back-production-bb9b.up.railway.app//api/notifications",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e.id,type:"group_invite",content:`You have been invited to join ${this.group.title}`})})}catch(t){console.error("Error creating notification:",t)}}else{const e=await o.text();console.error("Failed to send invitation:",e),this.showNotification("Failed to send invitation","error")}}catch(o){console.error("Error inviting user:",o),this.showNotification("Failed to send invitation","error")}},async fetchGroupMembers(){try{const e=await fetch(`https://back-production-bb9b.up.railway.app//api/groupmembers?group_id=${this.group.id}`,{credentials:"include"});if(e.ok){const t=await e.json();console.log("Fetched group members:",t),this.groupMembers=t}}catch(e){console.error("Error fetching group members:",e)}},async openInviteModal(){this.showInviteMembersModal=!0,await this.fetchAllUsers(),await this.fetchGroupMembers(),this.searchUsers()},formatMessageTime(e){const t=new Date,o=new Date(e),s=Math.abs(t-o)/36e5;return s<24?o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s<48?"Yesterday "+o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):o.toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}},mounted(){document.addEventListener("click",this.handleNotifClose)},beforeUnmount(){document.removeEventListener("click",this.handleNotifClose),this.socket&&this.socket.close()},computed:{unreadNotificationCount(){return this.notifications.filter((e=>!e.is_read)).length}}};const Ti=(0,u.A)(Fi,[["render",Mi],["__scopeId","data-v-aeec6024"]]);var $i=Ti;const xi={class:"profile-layout"},Xi={class:"sidebar"},Ui={class:"sidebar-icons"},Si={key:0,class:"notif-badge"},ji={key:0,ref:"notifPopup",class:"notif-popup"},Ai={class:"notif-list"},Gi={key:0,class:"notif-item empty"},Di=["onClick"],Oi={class:"notif-text"},qi={class:"notif-time"},Qi={class:"profile-main-content"},Ri={class:"profile-card-wrapper"},Bi={class:"profile-card"},Vi={class:"profile-image"},Hi=["src"],Ji={class:"username"},Wi={key:1,class:"follow-btn pending",disabled:""},Ki={class:"profile-details"},zi={key:0,class:"dob"},Yi={key:1},Zi={key:2,class:"nickname"},ea={key:3,class:"bio"},ta={class:"profile-stats"},oa={class:"stat"},sa={class:"stat"},ia={class:"stat"},aa={key:1,class:"followers-list"},na={key:2,class:"following-list"},ra={key:0,class:"user-posts"},ca={key:0},la={class:"post-header"},ua={class:"post-author"},da=["src"],ha={class:"post-author-info"},pa={class:"post-author-name"},ma={class:"post-date"},ga={class:"post-content"},ka=["src"],fa={key:0,class:"post-actions"},va=["onClick"],wa={class:"comments-count"},ba={key:1,class:"comments-section"},ya={class:"comment-header"},La=["src"],Ca={class:"comment-info"},Ea={class:"comment-author"},_a={class:"comment-date"},Na={class:"comment-text"},Pa=["src"],Ia={key:1},Ma={key:1,class:"private-message"},Fa={key:0},Ta={key:1};function $a(e,t,o,s,a,n){return(0,i.uX)(),(0,i.CE)("div",xi,[(0,i.Lk)("aside",Xi,[(0,i.Lk)("div",Ui,[(0,i.Lk)("div",{class:"sidebar-icon",title:"Home",onClick:t[0]||(t[0]=(...e)=>n.goToHome&&n.goToHome(...e))},t[10]||(t[10]=[(0,i.Lk)("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M3 12L12 3l9 9"}),(0,i.Lk)("path",{d:"M9 21V9h6v12"})],-1)])),t[16]||(t[16]=(0,i.Lk)("div",{class:"sidebar-icon active",title:"Profile"},[(0,i.Lk)("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("circle",{cx:"12",cy:"8",r:"4"}),(0,i.Lk)("path",{d:"M4 21v-2a4 4 0 014-4h8a4 4 0 014 4v2"})])],-1)),(0,i.Lk)("div",{class:"sidebar-icon",title:"Groups",onClick:t[1]||(t[1]=t=>e.$router.push("/mygroups"))},t[11]||(t[11]=[(0,i.Fv)('<svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" data-v-98dc176c><path d="M17 21v-2a4 4 0 00-4-4H7a4 4 0 00-4 4v2" data-v-98dc176c></path><circle cx="9" cy="7" r="4" data-v-98dc176c></circle><path d="M23 21v-2a4 4 0 00-3-3.87" data-v-98dc176c></path><path d="M16 3.13a4 4 0 010 7.75" data-v-98dc176c></path></svg>',1)])),(0,i.Lk)("div",{class:"sidebar-icon",ref:"notifBtn",title:"Notifications",onClick:t[2]||(t[2]=(...e)=>n.handleNotifClick&&n.handleNotifClick(...e))},[t[12]||(t[12]=(0,i.Lk)("svg",{width:"22",height:"22",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M18 8a6 6 0 10-12 0c0 7-3 9-3 9h18s-3-2-3-9"}),(0,i.Lk)("path",{d:"M13.73 21a2 2 0 01-3.46 0"})],-1)),a.unreadNotificationCount>0?((0,i.uX)(),(0,i.CE)("span",Si,(0,r.v_)(a.unreadNotificationCount),1)):(0,i.Q3)("",!0)],512),a.showNotifications?((0,i.uX)(),(0,i.CE)("div",ji,[t[13]||(t[13]=(0,i.Lk)("div",{class:"notif-popup-header"},"Notifications",-1)),(0,i.Lk)("ul",Ai,[a.notifications&&0!==a.notifications.length?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("li",Gi," No notifications yet. ")),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.notifications||[],(e=>((0,i.uX)(),(0,i.CE)("li",{key:e.id,class:(0,r.C4)(["notif-item",{unread:!e.is_read}]),onClick:t=>n.markNotificationAsRead(e.id)},[(0,i.Lk)("span",Oi,[(0,i.Lk)("b",null,(0,r.v_)(e.sender_username),1),(0,i.Lk)("span",null,(0,r.v_)(e.content),1)]),(0,i.Lk)("span",qi,(0,r.v_)(n.formatTimestamp(e.created_at)),1)],10,Di)))),128))])],512)):(0,i.Q3)("",!0),a.isOwner?((0,i.uX)(),(0,i.CE)("div",{key:1,class:"sidebar-icon",title:"Settings",onClick:t[3]||(t[3]=(...e)=>n.goToSettings&&n.goToSettings(...e))},t[14]||(t[14]=[(0,i.Lk)("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("circle",{cx:"12",cy:"12",r:"3"}),(0,i.Lk)("path",{d:"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09a1.65 1.65 0 00-1-1.51 1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09a1.65 1.65 0 001.51-1 1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06a1.65 1.65 0 001.82.33h.09A1.65 1.65 0 0011 3.09V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51h.09a1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06a1.65 1.65 0 00-.33 1.82v.09A1.65 1.65 0 0020.91 11H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"})],-1)]))):(0,i.Q3)("",!0),(0,i.Lk)("div",{class:"sidebar-icon",title:"Logout",onClick:t[4]||(t[4]=(...e)=>n.logout&&n.logout(...e))},t[15]||(t[15]=[(0,i.Lk)("svg",{width:"22",height:"22",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M17 16l4-4m0 0l-4-4m4 4H7"}),(0,i.Lk)("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"})],-1)]))])]),(0,i.Lk)("div",Qi,[(0,i.Lk)("div",Ri,[(0,i.Lk)("div",Bi,[a.isOwner?((0,i.uX)(),(0,i.CE)("button",{key:0,class:"settings-icon-btn",onClick:t[5]||(t[5]=(...e)=>n.goToSettings&&n.goToSettings(...e))},t[17]||(t[17]=[(0,i.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,i.Lk)("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),(0,i.Lk)("circle",{cx:"12",cy:"12",r:"3"})],-1)]))):(0,i.Q3)("",!0),(0,i.Lk)("div",Vi,[(0,i.Lk)("img",{src:a.user.avatar,alt:"Profile Picture"},null,8,Hi),(0,i.Lk)("p",Ji,"@"+(0,r.v_)(a.user.username),1),a.isOwner||"accepted"!==a.user.follow_status?a.isOwner||"pending"!==a.user.follow_status?a.isOwner||"not_following"!==a.user.follow_status?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("button",{key:2,onClick:t[7]||(t[7]=e=>n.follow(a.user.username)),class:"follow-btn"}," Follow ")):((0,i.uX)(),(0,i.CE)("button",Wi," Pending ")):((0,i.uX)(),(0,i.CE)("button",{key:0,onClick:t[6]||(t[6]=e=>n.unfollow(a.user.username)),class:"follow-btn following"}," Unfollow "))]),(0,i.Lk)("div",Ki,[(0,i.Lk)("h2",null,(0,r.v_)(a.user.first_name)+" "+(0,r.v_)(a.user.last_name),1),a.user.date_of_birth?((0,i.uX)(),(0,i.CE)("p",zi,(0,r.v_)(n.formatDate(a.user.date_of_birth)),1)):(0,i.Q3)("",!0),a.user.email&&(a.isOwner||a.isFollowing||"public"===a.user.privacy)?((0,i.uX)(),(0,i.CE)("p",Yi,(0,r.v_)(a.user.email),1)):(0,i.Q3)("",!0),a.user.nickname?((0,i.uX)(),(0,i.CE)("p",Zi,[t[18]||(t[18]=(0,i.Lk)("strong",null,"Nickname: ",-1)),(0,i.eW)((0,r.v_)(a.user.nickname),1)])):(0,i.Q3)("",!0),a.user.bio?((0,i.uX)(),(0,i.CE)("p",ea,(0,r.v_)(a.user.bio),1)):(0,i.Q3)("",!0)]),(0,i.Lk)("div",ta,[(0,i.Lk)("div",oa,[(0,i.Lk)("strong",{class:"clickable",onClick:t[8]||(t[8]=(...e)=>n.toggleFollowersList&&n.toggleFollowersList(...e))},(0,r.v_)(a.user.followers_count),1),t[19]||(t[19]=(0,i.Lk)("span",null,"Followers",-1))]),(0,i.Lk)("div",sa,[(0,i.Lk)("strong",{class:"clickable",onClick:t[9]||(t[9]=(...e)=>n.toggleFollowingList&&n.toggleFollowingList(...e))},(0,r.v_)(a.user.following_count),1),t[20]||(t[20]=(0,i.Lk)("span",null,"Following",-1))]),(0,i.Lk)("div",ia,[(0,i.Lk)("strong",null,(0,r.v_)(a.user.posts),1),t[21]||(t[21]=(0,i.Lk)("span",null,"Posts",-1))])]),a.showFollowersList&&n.canViewFollowData?((0,i.uX)(),(0,i.CE)("div",aa,[t[22]||(t[22]=(0,i.Lk)("h3",null,"Followers",-1)),(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.user.follower_usernames,(e=>((0,i.uX)(),(0,i.CE)("li",{key:e},(0,r.v_)(e),1)))),128))])])):(0,i.Q3)("",!0),a.showFollowingList&&n.canViewFollowData?((0,i.uX)(),(0,i.CE)("div",na,[t[23]||(t[23]=(0,i.Lk)("h3",null,"Following",-1)),(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.user.following_usernames,(e=>((0,i.uX)(),(0,i.CE)("li",{key:e},(0,r.v_)(e),1)))),128))])])):(0,i.Q3)("",!0)])]),n.canViewPosts?((0,i.uX)(),(0,i.CE)("div",ra,[t[25]||(t[25]=(0,i.Lk)("h3",null,"Posts",-1)),Array.isArray(a.posts)&&a.posts.length>0?((0,i.uX)(),(0,i.CE)("div",ca,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.posts,(e=>((0,i.uX)(),(0,i.CE)("div",{key:e.id,class:"post"},[(0,i.Lk)("div",la,[(0,i.Lk)("div",ua,[(0,i.Lk)("img",{src:a.user.avatar,alt:"Author Avatar",class:"post-avatar"},null,8,da),(0,i.Lk)("div",ha,[(0,i.Lk)("h4",null,(0,r.v_)(e.title),1),(0,i.Lk)("span",pa,(0,r.v_)(a.user.first_name)+" "+(0,r.v_)(a.user.last_name),1)])]),(0,i.Lk)("small",ma,(0,r.v_)(n.formatDate(e.creation_date)),1)]),(0,i.Lk)("div",ga,[(0,i.Lk)("p",null,(0,r.v_)(e.content),1),e.image?((0,i.uX)(),(0,i.CE)("img",{key:0,src:`${a.apiUrl}/uploads/`+e.image,alt:"Post Image",class:"post-image"},null,8,ka)):(0,i.Q3)("",!0)]),e.comments_count>0?((0,i.uX)(),(0,i.CE)("div",fa,[(0,i.Lk)("button",{onClick:t=>n.toggleComments(e.id)},(0,r.v_)(a.visibleCommentsPostId===e.id?"Hide Comments":"View Comments"),9,va),(0,i.Lk)("span",wa,(0,r.v_)(e.comments_count)+" comments",1)])):(0,i.Q3)("",!0),a.visibleCommentsPostId===e.id?((0,i.uX)(),(0,i.CE)("div",ba,[(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.Comments,(e=>((0,i.uX)(),(0,i.CE)("li",{key:e.id,class:"comment-item"},[(0,i.Lk)("div",ya,[e.Avatar?((0,i.uX)(),(0,i.CE)("img",{key:0,src:e.Avatar,alt:"Comment Avatar",class:"comment-avatar"},null,8,La)):(0,i.Q3)("",!0),(0,i.Lk)("div",Ca,[(0,i.Lk)("strong",Ea,(0,r.v_)(e.author),1),(0,i.Lk)("small",_a,(0,r.v_)(n.formatDate(e.creation_date)),1)])]),(0,i.Lk)("p",Na,(0,r.v_)(e.comment),1),e.image?((0,i.uX)(),(0,i.CE)("img",{key:0,src:`${a.apiUrl}/uploads/`+e.image,alt:"Comment Image",class:"comment-image"},null,8,Pa)):(0,i.Q3)("",!0)])))),128))])])):(0,i.Q3)("",!0)])))),128))])):((0,i.uX)(),(0,i.CE)("div",Ia,t[24]||(t[24]=[(0,i.Lk)("p",null,"No posts available.",-1)])))])):"private"!==a.user.privacy||a.isOwner?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",Ma,[t[26]||(t[26]=(0,i.Lk)("div",{class:"lock-icon"},"🔒",-1)),t[27]||(t[27]=(0,i.Lk)("h3",null,"This account is private",-1)),a.isPending?((0,i.uX)(),(0,i.CE)("p",Fa,"Your follow request is pending approval.")):((0,i.uX)(),(0,i.CE)("p",Ta,"Follow this account to see their posts."))]))])])}var xa={name:"ProfileInfo",data(){return{apiUrl:(void 0).VITE_API_URL,isOwner:!1,isFollowing:!1,isPending:!1,showFollowersList:!1,showFollowingList:!1,posts:[],Comments:[],currentUserId:null,visibleCommentsPostId:null,showNotifications:!1,notifications:[],unreadNotificationCount:0,user:{image:"",username:"",nickname:"",avatar:"",first_name:"",last_name:"",bio:"",followers_count:0,following_count:0,follower_usernames:[],following_usernames:[],posts:0,privacy:"public",date_of_birth:"",email:"",follow_status:""}}},beforeRouteEnter(e,t,o){fetch("https://back-production-bb9b.up.railway.app//api/info",{method:"GET",credentials:"include"}).then((e=>{e.ok?o():o("/login")})).catch((()=>{o("/login")}))},computed:{canViewPosts(){return"public"===this.user.privacy||"private"===this.user.privacy&&this.isFollowing||this.isOwner},canViewFollowData(){return"public"===this.user.privacy||"private"===this.user.privacy&&this.isFollowing||this.isOwner}},async created(){const e=this.$route.params.id,t=await this.getData();if(console.log("Current User ID:",t),!t)return console.error("User is not logged in. Redirecting to login page."),void this.$router.push("/login");this.fetchuserData(e),this.isOwner=t===e},methods:{goToSettings(){this.$router.push("/settings")},async toggleComments(e){this.visibleCommentsPostId===e?(this.visibleCommentsPostId=null,this.Comments=[]):(this.visibleCommentsPostId=e,await this.getComments(e))},getComments(e){return fetch(`https://back-production-bb9b.up.railway.app//api/getcomments?post_id=${e}`,{method:"GET",credentials:"include"}).then((e=>{if(!e.ok)throw new Error("Failed to fetch comments");return e.json()})).then((e=>{console.log("Comments fetched:",e);for(let t=0;t<e.length;t++)e[t].Avatar?e[t].Avatar=`https://back-production-bb9b.up.railway.app//uploads/${e[t].Avatar}`:e[t].Avatar=`https://api.dicebear.com/7.x/avataaars/svg?seed=${e[t].Author}`;this.Comments=e||[],console.log("Comments:",this.Comments)})).catch((e=>{console.error("Error fetching comments:",e)}))},async getData(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/info",{method:"GET",credentials:"include"});if(!e.ok){if(404===e.status)return void this.$router.push("/404");if(401===e.status)return void this.$router.push("/");throw new Error("Failed to fetch data")}const t=await e.json();return t.Username}catch(e){throw console.error("Error fetching data:",e),this.$router.push("/404"),e}},checkIfFollowing(){this.user.username&&fetch(`https://back-production-bb9b.up.railway.app//api/followers?action=isFollowing&profileUser=${this.user.username}`,{method:"GET",credentials:"include"}).then((e=>{if(!e.ok){if(404===e.status)return void this.$router.push("/404");throw new Error("Failed to fetch follow status")}return e.json()})).then((e=>{this.isFollowing=e.isFollowing&&"accepted"===e.status,this.isPending=e.isFollowing&&"pending"===e.status})).catch((e=>{console.error("Error checking follow status:",e),this.$router.push("/404"),this.isFollowing=!1,this.isPending=!1}))},goToHome(){this.$router.push("/")},goToSettings(){this.$router.push("/settings")},logout(){fetch("https://back-production-bb9b.up.railway.app//api/auth/logout",{method:"POST",credentials:"include"}).then((e=>{e.ok||console.error("Logout failed"),this.$router.push("/login")})).catch((e=>{console.error("Logout error:",e),this.$router.push("/login")}))},async fetchuserData(e){try{const t=await fetch(`https://back-production-bb9b.up.railway.app//api/userinfo?user_id=${e}`,{method:"GET",credentials:"include"});if(!t.ok){if(404===t.status)return void this.$router.push("/404");if(401===t.status)return void this.$router.push("/");throw new Error("Failed to fetch user data")}const o=await t.json();console.log("User data fetched:",o),this.user=o,this.user.avatar?this.user.avatar=`https://back-production-bb9b.up.railway.app//uploads/${this.user.avatar}`:this.user.avatar=`https://api.dicebear.com/7.x/avataaars/svg?seed=${o.username}`,this.canViewPosts&&await this.fetchUserPosts(o.username),await this.checkIfFollowing()}catch(t){console.error("Error fetching user data:",t),this.$router.push("/404")}},fetchUserPosts(e){fetch(`https://back-production-bb9b.up.railway.app//api/ownposts?username=${e}`,{method:"GET",credentials:"include"}).then((e=>{if(!e.ok){if(404===e.status)return void this.$router.push("/404");throw new Error("Failed to fetch user posts")}return e.json()})).then((e=>{this.posts=e||[],console.log("User posts fetched:",this.posts)})).catch((e=>{console.error("Error fetching user posts:",e),this.$router.push("/404")}))},toggleFollowersList(){this.canViewFollowData&&(this.showFollowersList=!this.showFollowersList,this.showFollowingList=!1)},toggleFollowingList(){this.canViewFollowData&&(this.showFollowingList=!this.showFollowingList,this.showFollowersList=!1)},async follow(e){try{const t=await fetch(`https://back-production-bb9b.up.railway.app//api/followers?action=follow&profileUser=${e}`,{method:"POST",credentials:"include"});if(!t.ok)throw new Error("Follow failed");await t.text(),"private"===this.user.privacy?(this.isPending=!0,this.isFollowing=!1):(this.isFollowing=!0,this.isPending=!1),await this.fetchuserData(this.user.username),setTimeout((()=>{this.checkIfFollowing()}),500)}catch(t){console.error("Follow error:",t),this.isFollowing=!1,this.isPending=!1}},async unfollow(e){try{const t=await fetch(`https://back-production-bb9b.up.railway.app//api/followers?action=unfollow&profileUser=${e}`,{method:"POST",credentials:"include"});if(!t.ok)throw new Error("Unfollow failed");this.isFollowing=!1,this.isPending=!1,await this.fetchuserData(this.user.username),this.canViewPosts||(this.posts=[]),setTimeout((()=>{this.checkIfFollowing()}),300)}catch(t){console.error("Unfollow error:",t)}},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleDateString()},async handleNotifClick(){this.showNotifications=!this.showNotifications,this.showNotifications&&await this.fetchNotifications()},async fetchNotifications(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/notifications",{method:"GET",credentials:"include"});if(e.ok){const t=await e.json();this.notifications=t,this.unreadNotificationCount=t.filter((e=>!e.is_read)).length}}catch(e){console.error("Failed to fetch notifications:",e)}},async markNotificationAsRead(e){console.log(e);try{const t=this.notifications.find((t=>t.id===e));if(!t)return;setTimeout((async()=>{try{const o=await fetch("https://back-production-bb9b.up.railway.app//api/markasread",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({notificationId:e,is_read:1})});console.log("res",o),o.ok&&(t.is_read=!0)}catch(o){console.error("Error marking notification as read:",o)}}),3e3)}catch(t){console.error("Error marking notification as read:",t)}},formatTimestamp(e){if(!e)return"";const t=new Date(e),o=new Date,s=o-t;return s<6e4?"just now":s<36e5?`${Math.floor(s/6e4)}m ago`:s<864e5?`${Math.floor(s/36e5)}h ago`:s<6048e5?`${Math.floor(s/864e5)}d ago`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},handleNotifClose(e){!this.showNotifications||this.$refs.notifBtn.contains(e.target)||this.$refs.notifPopup.contains(e.target)||(this.showNotifications=!1)}},mounted(){document.addEventListener("click",this.handleNotifClose),this.fetchNotifications()},beforeUnmount(){document.removeEventListener("click",this.handleNotifClose)}};const Xa=(0,u.A)(xa,[["render",$a],["__scopeId","data-v-98dc176c"]]);var Ua=Xa;const Sa={class:"settings-layout"},ja={class:"sidebar"},Aa={class:"sidebar-icons"},Ga={key:0,class:"notif-badge"},Da={key:0,ref:"notifPopup",class:"notif-popup"},Oa={class:"notif-list"},qa={key:0,class:"notif-item empty"},Qa=["onClick"],Ra={class:"notif-text"},Ba={class:"notif-time"},Va={class:"settings-main-content"},Ha={class:"settings-card-wrapper"},Ja={class:"settings-card"},Wa={class:"privacy-section"},Ka={class:"privacy-status"},za={key:0},Ya={class:"invitations-section"},Za={key:0},en={key:0,class:"no-invitations"},tn={class:"invitation-actions"},on=["onClick"],sn=["onClick"];function an(e,t,o,a,n,c){return(0,i.uX)(),(0,i.CE)("div",Sa,[(0,i.Lk)("aside",ja,[(0,i.Lk)("div",Aa,[(0,i.Lk)("div",{class:"sidebar-icon",title:"Home",onClick:t[0]||(t[0]=(...e)=>c.goToHome&&c.goToHome(...e))},t[8]||(t[8]=[(0,i.Lk)("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M3 12L12 3l9 9"}),(0,i.Lk)("path",{d:"M9 21V9h6v12"})],-1)])),(0,i.Lk)("div",{class:"sidebar-icon",title:"Profile",onClick:t[1]||(t[1]=t=>e.$router.push("/profile/"+n.user.name))},t[9]||(t[9]=[(0,i.Lk)("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("circle",{cx:"12",cy:"8",r:"4"}),(0,i.Lk)("path",{d:"M4 21v-2a4 4 0 014-4h8a4 4 0 014 4v2"})],-1)])),(0,i.Lk)("div",{class:"sidebar-icon",title:"Groups",onClick:t[2]||(t[2]=t=>e.$router.push("/mygroups"))},t[10]||(t[10]=[(0,i.Fv)('<svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" data-v-7e4cec74><path d="M17 21v-2a4 4 0 00-4-4H7a4 4 0 00-4 4v2" data-v-7e4cec74></path><circle cx="9" cy="7" r="4" data-v-7e4cec74></circle><path d="M23 21v-2a4 4 0 00-3-3.87" data-v-7e4cec74></path><path d="M16 3.13a4 4 0 010 7.75" data-v-7e4cec74></path></svg>',1)])),(0,i.Lk)("div",{class:"sidebar-icon",ref:"notifBtn",title:"Notifications",onClick:t[3]||(t[3]=(...e)=>c.handleNotifClick&&c.handleNotifClick(...e))},[t[11]||(t[11]=(0,i.Lk)("svg",{width:"22",height:"22",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M18 8a6 6 0 10-12 0c0 7-3 9-3 9h18s-3-2-3-9"}),(0,i.Lk)("path",{d:"M13.73 21a2 2 0 01-3.46 0"})],-1)),n.unreadNotificationCount>0?((0,i.uX)(),(0,i.CE)("span",Ga,(0,r.v_)(n.unreadNotificationCount),1)):(0,i.Q3)("",!0)],512),n.showNotifications?((0,i.uX)(),(0,i.CE)("div",Da,[t[12]||(t[12]=(0,i.Lk)("div",{class:"notif-popup-header"},"Notifications",-1)),(0,i.Lk)("ul",Oa,[n.notifications&&0!==n.notifications.length?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("li",qa," No notifications yet. ")),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.notifications||[],(e=>((0,i.uX)(),(0,i.CE)("li",{key:e.id,class:(0,r.C4)(["notif-item",{unread:!e.is_read}]),onClick:t=>c.markNotificationAsRead(e.id)},[(0,i.Lk)("span",Ra,[(0,i.Lk)("b",null,(0,r.v_)(e.sender_username),1),(0,i.Lk)("span",null,(0,r.v_)(e.content),1)]),(0,i.Lk)("span",Ba,(0,r.v_)(c.formatTimestamp(e.created_at)),1)],10,Qa)))),128))])],512)):(0,i.Q3)("",!0),(0,i.Lk)("div",{class:"sidebar-icon",title:"Logout",onClick:t[4]||(t[4]=(...e)=>c.logout&&c.logout(...e))},t[13]||(t[13]=[(0,i.Lk)("svg",{width:"22",height:"22",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M17 16l4-4m0 0l-4-4m4 4H7"}),(0,i.Lk)("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"})],-1)]))])]),(0,i.Lk)("div",Va,[(0,i.Lk)("div",Ha,[(0,i.Lk)("div",Ja,[t[17]||(t[17]=(0,i.Lk)("h2",null,"Privacy Settings",-1)),(0,i.Lk)("div",Wa,[(0,i.Lk)("p",Ka," Current Profile Status: "+(0,r.v_)(n.isProfilePrivate?"Private":"Public"),1),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>n.selectedPrivacy=e),onChange:t[6]||(t[6]=(...e)=>c.updatePrivacy&&c.updatePrivacy(...e)),class:"privacy-select"},t[14]||(t[14]=[(0,i.Lk)("option",{class:"option",value:"public"},"Public",-1),(0,i.Lk)("option",{class:"option",value:"private"},"Private",-1)]),544),[[s.u1,n.selectedPrivacy]])]),n.isProfilePrivate?((0,i.uX)(),(0,i.CE)("div",za,[t[16]||(t[16]=(0,i.Lk)("h2",null,"Follow Requests",-1)),(0,i.Lk)("div",Ya,[(0,i.Lk)("button",{class:"action-btn",onClick:t[7]||(t[7]=e=>n.showInvitations=!n.showInvitations)},(0,r.v_)(n.showInvitations?"Hide Invitations":"View Invitations"),1),n.showInvitations?((0,i.uX)(),(0,i.CE)("div",Za,[t[15]||(t[15]=(0,i.Lk)("h3",null,"Pending Follow Requests",-1)),0===n.pendingInvitations.length?((0,i.uX)(),(0,i.CE)("div",en," No pending follow requests ")):(0,i.Q3)("",!0),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.pendingInvitations,(e=>((0,i.uX)(),(0,i.CE)("div",{key:e.id,class:"invitation-card"},[(0,i.Lk)("span",null,(0,r.v_)(e.username),1),(0,i.Lk)("div",tn,[(0,i.Lk)("button",{class:"accept-btn",onClick:t=>c.acceptInvitation(e.username)},"Accept",8,on),(0,i.Lk)("button",{class:"reject-btn",onClick:t=>c.rejectInvitation(e.username)},"Reject",8,sn)])])))),128))])):(0,i.Q3)("",!0)])])):(0,i.Q3)("",!0)])])])])}var nn={name:"MySettings",data(){return{selectedPrivacy:"public",isProfilePrivate:!1,showInvitations:!1,pendingInvitations:[],user:{name:""},showNotifications:!1,notifications:[],unreadNotificationCount:0}},beforeRouteEnter(e,t,o){fetch("https://back-production-bb9b.up.railway.app//api/info",{method:"GET",credentials:"include"}).then((e=>{e.ok?o():o("/login")})).catch((()=>{o("/login")}))},methods:{async updatePrivacy(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/updateprivacy",{method:"POST",credentials:"include",body:JSON.stringify({privacy:this.selectedPrivacy})});e.ok?this.isProfilePrivate="private"===this.selectedPrivacy:console.error("Failed to update privacy")}catch(e){console.error("Failed to update privacy:",e)}},async fetchInvitations(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/getinvitationsfollow",{method:"GET",credentials:"include"}),t=await e.json();this.pendingInvitations=t||[]}catch(e){console.error("Failed to fetch invitations:",e),this.pendingInvitations=[]}},async acceptInvitation(e){try{const t=await fetch("https://back-production-bb9b.up.railway.app//api/accepteinvi",{method:"POST",credentials:"include",body:JSON.stringify({follower_id:e})});t.ok&&(this.pendingInvitations=this.pendingInvitations.filter((t=>t.username!==e)))}catch(t){console.error("Failed to accept invitation:",t)}},async rejectInvitation(e){try{const t=await fetch(`https://back-production-bb9b.up.railway.app//api/followers?action=rejectInvitation&profileUser=${e}`,{method:"POST",credentials:"include"});t.ok&&(this.pendingInvitations=this.pendingInvitations.filter((t=>t.id!==e)))}catch(t){console.error("Failed to reject invitation:",t)}},async checkprivacy(){const e=await fetch("https://back-production-bb9b.up.railway.app//api/checkmyprivacy",{credentials:"include"}),t=await e.json();"private"===t.privacy?(this.isProfilePrivate=!0,this.selectedPrivacy="private"):(this.isProfilePrivate=!1,this.selectedPrivacy="public")},logout(){fetch("https://back-production-bb9b.up.railway.app//api/auth/logout",{method:"POST",credentials:"include"}).then((e=>{e.ok||console.error("Logout failed"),this.$router.push("/login")})).catch((e=>{console.error("Logout error:",e),this.$router.push("/login")}))},goToHome(){this.$router.push("/home")},async handleNotifClick(){this.showNotifications=!this.showNotifications,this.showNotifications&&await this.fetchNotifications()},async fetchNotifications(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//api/notifications",{method:"GET",credentials:"include"});if(e.ok){const t=await e.json();this.notifications=t,this.unreadNotificationCount=t.filter((e=>!e.is_read)).length}}catch(e){console.error("Failed to fetch notifications:",e)}},async markNotificationAsRead(e){console.log(e);try{const t=this.notifications.find((t=>t.id===e));if(!t)return;setTimeout((async()=>{try{const o=await fetch("https://back-production-bb9b.up.railway.app//api/markasread",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({notificationId:e,is_read:1})});console.log("res",o),o.ok&&(t.is_read=!0)}catch(o){console.error("Error marking notification as read:",o)}}),300)}catch(t){console.error("Error marking notification as read:",t)}},formatTimestamp(e){if(!e)return"";const t=new Date(e),o=new Date,s=o-t;return s<6e4?"just now":s<36e5?`${Math.floor(s/6e4)}m ago`:s<864e5?`${Math.floor(s/36e5)}h ago`:s<6048e5?`${Math.floor(s/864e5)}d ago`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},handleNotifClose(e){!this.showNotifications||this.$refs.notifBtn.contains(e.target)||this.$refs.notifPopup.contains(e.target)||(this.showNotifications=!1)}},async created(){const e=await fetch("https://back-production-bb9b.up.railway.app//api/info",{method:"GET",credentials:"include"}),t=await e.json();this.user.name=t.Username,console.log("userData",this.user.name),await this.checkprivacy(),await this.fetchInvitations()},mounted(){document.addEventListener("click",this.handleNotifClose),this.fetchNotifications()},beforeUnmount(){document.removeEventListener("click",this.handleNotifClose)}};const rn=(0,u.A)(nn,[["render",an],["__scopeId","data-v-7e4cec74"]]);var cn=rn;const ln={class:"error-container"},un={class:"error-content"},dn={class:"error-actions"};function hn(e,t,o,s,a,n){return(0,i.uX)(),(0,i.CE)("div",ln,[(0,i.Lk)("div",un,[t[4]||(t[4]=(0,i.Fv)('<div class="error-icon" data-v-1c0b082a><svg width="120" height="120" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" data-v-1c0b082a><circle cx="12" cy="12" r="10" data-v-1c0b082a></circle><line x1="12" y1="8" x2="12" y2="12" data-v-1c0b082a></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-1c0b082a></line></svg></div><h1 class="error-title" data-v-1c0b082a>404</h1><h2 class="error-subtitle" data-v-1c0b082a>Page Not Found</h2><p class="error-message" data-v-1c0b082a>Oops! The page you&#39;re looking for doesn&#39;t exist or has been moved.</p>',4)),(0,i.Lk)("div",dn,[(0,i.Lk)("button",{class:"primary-btn",onClick:t[0]||(t[0]=t=>e.$router.push("/"))},t[2]||(t[2]=[(0,i.Lk)("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M3 12l9-9 9 9"}),(0,i.Lk)("path",{d:"M9 21V9h6v12"})],-1),(0,i.eW)(" Back to Home ")])),(0,i.Lk)("button",{class:"secondary-btn",onClick:t[1]||(t[1]=t=>e.$router.go(-1))},t[3]||(t[3]=[(0,i.Lk)("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[(0,i.Lk)("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),(0,i.eW)(" Go Back ")]))])])])}var pn={name:"ErrorPage"};const mn=(0,u.A)(pn,[["render",hn],["__scopeId","data-v-1c0b082a"]]);var gn=mn;async function kn(){try{const e=await fetch("https://back-production-bb9b.up.railway.app//middle",{method:"GET",credentials:"include"}),t=await e.json();return"Login successful"===t.message}catch(e){return console.error("Error during login check:",e),!1}}const fn=[{path:"/login",component:E,beforeEnter:async(e,t,o)=>{const s=await kn();s?o("/home"):o()},meta:{requiresAuth:!1}},{path:"/register",component:x,beforeEnter:async(e,t,o)=>{const s=await kn();s?o("/home"):o()}},{path:"/",component:j},{path:"/info",component:q},{path:"/home",component:Ft},{path:"/messages",component:Xt},{path:"/mygroups",component:uo},{path:"/group/:id",component:$i},{path:"/profile/:id",component:Ua},{path:"/settings",component:cn},{path:"/:pathMatch(.*)*",name:"NotFound",component:gn}],vn=(0,k.aE)({history:(0,k.LA)(),routes:fn});var wn=vn;(0,s.Ef)(g).use(wn).mount("#app")}},t={};function o(s){var i=t[s];if(void 0!==i)return i.exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,o),a.exports}o.m=e,function(){var e=[];o.O=function(t,s,i,a){if(!s){var n=1/0;for(u=0;u<e.length;u++){s=e[u][0],i=e[u][1],a=e[u][2];for(var r=!0,c=0;c<s.length;c++)(!1&a||n>=a)&&Object.keys(o.O).every((function(e){return o.O[e](s[c])}))?s.splice(c--,1):(r=!1,a<n&&(n=a));if(r){e.splice(u--,1);var l=i();void 0!==l&&(t=l)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[s,i,a]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};o.O.j=function(t){return 0===e[t]};var t=function(t,s){var i,a,n=s[0],r=s[1],c=s[2],l=0;if(n.some((function(t){return 0!==e[t]}))){for(i in r)o.o(r,i)&&(o.m[i]=r[i]);if(c)var u=c(o)}for(t&&t(s);l<n.length;l++)a=n[l],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(u)},s=self["webpackChunkmy_vue_app"]=self["webpackChunkmy_vue_app"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=o.O(void 0,[504],(function(){return o(4842)}));s=o.O(s)})();
//# sourceMappingURL=app.2481d8e5.js.map